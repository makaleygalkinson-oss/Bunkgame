// –õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä—ã

let currentLobbyId = null;
let currentUserId = null;
let blurRealtimeChannel = null;
let playersRealtimeChannel = null;
let heartbeatInterval = null;
let activityCheckInterval = null;
let inactivityTimer = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üéÆ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Supabase
    if (typeof supabase === 'undefined') {
        console.error('‚ùå Supabase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –ª–æ–±–±–∏
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–Ω–∞—á–∞–ª–∞ –≤ localStorage, –ø–æ—Ç–æ–º –≤ sessionStorage
    let userStr = localStorage.getItem('currentUser');
    if (!userStr) {
        userStr = sessionStorage.getItem('currentUser');
    }
    const lobbyIdStr = sessionStorage.getItem('currentLobbyId');
    
    if (!userStr) {
        console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é');
        window.location.href = 'index.html';
        return;
    }
    
    try {
        const user = JSON.parse(userStr);
        currentUserId = user.id;
        
        if (!lobbyIdStr) {
            // –ï—Å–ª–∏ –Ω–µ—Ç lobby_id –≤ sessionStorage, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ë–î
            const { data: userData, error } = await supabase
                .from('users')
                .select('lobby_id')
                .eq('id', currentUserId)
                .maybeSingle();
            
            if (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ lobby_id:', error);
                window.location.href = 'index.html';
                return;
            }
            
            if (!userData || !userData.lobby_id || userData.lobby_id === 0) {
                console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –ª–æ–±–±–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é');
                window.location.href = 'index.html';
                return;
            }
            
            currentLobbyId = userData.lobby_id.toString();
            sessionStorage.setItem('currentLobbyId', currentLobbyId);
        } else {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–≥—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ –ª–æ–±–±–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –µ–≥–æ —É–¥–∞–ª–∏–ª–∏)
            const { data: userData, error } = await supabase
                .from('users')
                .select('lobby_id')
                .eq('id', currentUserId)
                .maybeSingle();
            
            if (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ lobby_id:', error);
                window.location.href = 'index.html';
                return;
            }
            
            if (!userData || !userData.lobby_id || userData.lobby_id === 0 || userData.lobby_id.toString() !== lobbyIdStr) {
                console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ –ª–æ–±–±–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é');
                sessionStorage.removeItem('currentLobbyId');
                window.location.href = 'index.html';
                return;
            }
            
            currentLobbyId = userData.lobby_id.toString();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
        await initializePlayerColors();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–æ–±–±–∏
        await loadLobbyInfo();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∏–≥—Ä–æ–∫–∞—Ö
        await loadPlayersInfo();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur –∏–∑ –ë–î
        await loadBlurStatesFromDB();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –±—É–Ω–∫–µ—Ä–∞
        await loadBunkerCard();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
        await checkAndApplyCardsLockState();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±—É–Ω–∫–µ—Ä–∞
        await loadBunkerSecretInfo();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
        await loadVoting();
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö blur —É–∂–µ —Å–Ω—è—Ç
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
        setTimeout(() => {
            restoreUnblurredData();
        }, 200);
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
        setupExitButton();
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã
        setupStartGameButton();
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫
        setupFlipCards();
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è blur
        subscribeToBlurUpdates();
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
        subscribeToPlayersUpdates();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º heartbeat –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        startHeartbeat();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
        startActivityCheck();
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        setupInactivityHandlers();
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:', err);
        window.location.href = 'index.html';
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–æ–±–±–∏
async function loadLobbyInfo() {
    const gameInfo = document.getElementById('gameInfo');
    if (!gameInfo) return;
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–æ–±–±–∏
        const { data: lobby, error: lobbyError } = await supabase
            .from('lobbies')
            .select('lobby_id, creator_name, active_role')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (lobbyError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–±–±–∏:', lobbyError);
            gameInfo.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–æ–±–±–∏</p>';
            return;
        }
        
        if (!lobby) {
            gameInfo.innerHTML = '<p class="game-error">–õ–æ–±–±–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        const { data: players, error: playersError } = await supabase
            .from('users')
            .select('id, name, email')
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (playersError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:', playersError);
        }
        
        const roleNames = {
            'maniac': '–ú–∞–Ω—å—è–∫',
            'killer': '–£–±–∏–π—Ü–∞',
            'both': '–ú–∞–Ω—å—è–∫ –∏ —É–±–∏–π—Ü–∞',
            'none': '–ë–µ–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–ª–µ–π'
        };
        
        const roleName = roleNames[lobby.active_role] || lobby.active_role;
        const playersList = players && players.length > 0 
            ? players.map(p => p.name || p.email).join(', ')
            : '–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤';
        
        gameInfo.innerHTML = `
            <div class="game-lobby-info">
                <p><strong>ID –õ–æ–±–±–∏:</strong> ${lobby.lobby_id}</p>
                <p><strong>–°–æ–∑–¥–∞—Ç–µ–ª—å:</strong> ${lobby.creator_name}</p>
                <p><strong>–ê–∫—Ç–∏–≤–Ω–∞—è —Ä–æ–ª—å:</strong> ${roleName}</p>
                <p><strong>–ò–≥—Ä–æ–∫–∏ –≤ –ª–æ–±–±–∏:</strong> ${playersList}</p>
            </div>
        `;
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–æ–±–±–∏:', err);
        gameInfo.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>';
    }
}


// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
function setupExitButton() {
    const exitBtn = document.getElementById('exitLobbyBtn');
    if (!exitBtn) {
        console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    exitBtn.addEventListener('click', async () => {
        const confirmExit = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –ª–æ–±–±–∏?');
        if (!confirmExit) return;
        
        await exitFromLobby();
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Å—Ä–æ–∫–∞ –∂–∏–∑–Ω–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
function generateLifetime(lifetimeRange) {
    // –ü–∞—Ä—Å–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω –≤–∏–¥–∞ "1‚Äì5 –ª–µ—Ç" –∏–ª–∏ "6‚Äì18 –º–µ—Å—è—Ü–µ–≤"
    const match = lifetimeRange.match(/(\d+)[‚Äì-](\d+)\s+(–ª–µ—Ç|–º–µ—Å—è—Ü|–º–µ—Å—è—Ü–µ–≤|–º–µ—Å—è—Ü–∞)/);
    if (!match) {
        return { value: 1, unit: '–ª–µ—Ç' };
    }
    
    const min = parseInt(match[1]);
    const max = parseInt(match[2]);
    const unit = match[3];
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    const randomValue = Math.floor(Math.random() * (max - min + 1)) + min;
    
    return { value: randomValue, unit: unit };
}

// –°–ø–∏—Å–æ–∫ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏ —Å—Ä–æ–∫–∞–º–∏ –∂–∏–∑–Ω–∏ –≤ –±—É–Ω–∫–µ—Ä–µ
const CATASTROPHES = [
    {
        name: '–Ø–¥–µ—Ä–Ω—ã–π –≤–∑—Ä—ã–≤',
        description: '–°–µ—Ä–∏—è –¥–µ—Ç–æ–Ω–∞—Ü–∏–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏—Ö —è–¥–µ—Ä–Ω—ã—Ö –±–æ–µ–≥–æ–ª–æ–≤–æ–∫, –≤—ã–∑–≤–∞–≤—à–∞—è —è–¥–µ—Ä–Ω—É—é –∑–∏–º—É. –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –ø–ª–∞–Ω–µ—Ç—ã –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–∞ –¥–ª—è –∂–∏–∑–Ω–∏ –∏–∑-–∑–∞ —Ä–∞–¥–∏–∞—Ü–∏–∏, –∞ –Ω–µ–±–æ –∑–∞—Ç—è–Ω—É—Ç–æ —Å–∞–∂–µ–π, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–ª–Ω–µ—á–Ω—ã–π —Å–≤–µ—Ç –∏ —Ä–µ–∑–∫–æ —Å–Ω–∏–∂–∞–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É.',
        lifetimeRange: '1‚Äì5 –ª–µ—Ç'
    },
    {
        name: '–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ',
        description: '–ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø–ª–∞–Ω–µ—Ç—ã. –í—ã–∑—ã–≤–∞–µ—Ç —Ç–∞—è–Ω–∏–µ –ª–µ–¥–Ω–∏–∫–æ–≤, –ø–æ–¥–Ω—è—Ç–∏–µ —É—Ä–æ–≤–Ω—è –º–æ—Ä—è, –∑–∞—Ç–æ–ø–ª–µ–Ω–∏–µ –ø—Ä–∏–±—Ä–µ–∂–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤, –æ–ø—É—Å—Ç—ã–Ω–∏–≤–∞–Ω–∏–µ –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã—Ö –∑–µ–º–µ–ª—å –∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è, –¥–µ–ª–∞—è –º–∏—Ä –Ω–µ—É–∑–Ω–∞–≤–∞–µ–º—ã–º.',
        lifetimeRange: '3‚Äì10 –ª–µ—Ç'
    },
    {
        name: '–í–∏—Ä—É—Å–Ω–∞—è –ø–∞–Ω–¥–µ–º–∏—è',
        description: '–ü–æ—è–≤–ª–µ–Ω–∏–µ –∏ –±—ã—Å—Ç—Ä–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã—Å–æ–∫–æ–ª–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏ –∑–∞—Ä–∞–∑–Ω–æ–≥–æ –≤–∏—Ä—É—Å–∞. –û–Ω —É–±–∏–≤–∞–µ—Ç –∏–ª–∏ –æ—Å–ª–∞–±–ª—è–µ—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è –ó–µ–º–ª–∏. –¶–∏–≤–∏–ª–∏–∑–∞—Ü–∏—è —Ä—É—à–∏—Ç—Å—è –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ —Ä–∞–±–æ—á–µ–π —Å–∏–ª—ã –∏ –ø–∞–Ω–∏–∫–∏.',
        lifetimeRange: '6‚Äì18 –º–µ—Å—è—Ü–µ–≤'
    },
    {
        name: '–ö–æ–º–µ—Ç–∞',
        description: '–°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –ó–µ–º–ª–∏ —Å –∫—Ä—É–ø–Ω–æ–π –∫–æ–º–µ—Ç–æ–π –∏–ª–∏ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–º. –£–¥–∞—Ä –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∑—Ä—ã–≤, —Å—Ä–∞–≤–Ω–∏–º—ã–π —Å —Ç—ã—Å—è—á–∞–º–∏ —è–¥–µ—Ä–Ω—ã—Ö –±–æ–º–±, –∞ –ø–æ–¥–Ω—è–≤—à–∞—è—Å—è –ø—ã–ª—å –∏ –æ–±–ª–æ–º–∫–∏ –ø–æ–≥—Ä—É–∂–∞—é—Ç –ø–ª–∞–Ω–µ—Ç—É –≤ –¥–æ–ª–≥—É—é, —Ç—ë–º–Ω—É—é ¬´—É–¥–∞—Ä–Ω—É—é –∑–∏–º—É¬ª.',
        lifetimeRange: '2‚Äì5 –ª–µ—Ç'
    },
    {
        name: '–ù–∞–ø–∞–¥–µ–Ω–∏–µ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω',
        description: '–ü—Ä–∏–±—ã—Ç–∏–µ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç–Ω–æ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏ —Å —è–≤–Ω—ã–º–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è–º–∏. –ò—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—è—Ç –∑–µ–º–Ω—ã–µ. –ö—Ä—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã, –∞ –æ—Å—Ç–∞—Ç–∫–∏ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏ –≤–µ–¥—É—Ç –ø–∞—Ä—Ç–∏–∑–∞–Ω—Å–∫—É—é –≤–æ–π–Ω—É.',
        lifetimeRange: '10‚Äì20 –ª–µ—Ç'
    },
    {
        name: '–ó–æ–º–±–∏-–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å',
        description: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∞—Ç–æ–≥–µ–Ω –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª—é–¥–µ–π –≤ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö, –Ω–µ—Ä–∞–∑—É–º–Ω—ã—Ö —Ö–∏—â–Ω–∏–∫–æ–≤ (–∑–æ–º–±–∏). –í–ª–∞—Å—Ç—å –∏ –∞—Ä–º–∏—è –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –±—ã—Å—Ç—Ä—ã–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ–º, –∏ –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω–æ–π, –∫–∏—à–∞—â–µ–π –∂–∏–≤—ã–º–∏ –º–µ—Ä—Ç–≤–µ—Ü–∞–º–∏.',
        lifetimeRange: '1‚Äì3 –≥–æ–¥–∞'
    },
    {
        name: '–°–æ–ª–Ω–µ—á–Ω–∞—è –≤—Å–ø—ã—à–∫–∞',
        description: '–ß—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –º–æ—â–Ω—ã–π –≤—ã–±—Ä–æ—Å –∫–æ—Ä–æ–Ω–∞–ª—å–Ω–æ–π –º–∞—Å—Å—ã, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø—Ä—è–º–æ –Ω–∞ –ó–µ–º–ª—é. –í—ã–∑—ã–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–π –∏–º–ø—É–ª—å—Å (–≠–ú–ò), –≤—ã–≤–æ–¥—è—â–∏–π –∏–∑ —Å—Ç—Ä–æ—è –≤—Å—é —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫—É, –ª–∏–Ω–∏–∏ —ç–ª–µ–∫—Ç—Ä–æ–ø–µ—Ä–µ–¥–∞—á –∏ —Å–ø—É—Ç–Ω–∏–∫–∏. –ú–∏—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–æ—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫—É—é —ç–ø–æ—Ö—É.',
        lifetimeRange: '3‚Äì12 –º–µ—Å—è—Ü–µ–≤'
    },
    {
        name: '–°–≤–µ—Ä—Ö–º–∞—Å—Å–∏–≤–Ω–æ–µ –∏–∑–≤–µ—Ä–∂–µ–Ω–∏–µ –≤—É–ª–∫–∞–Ω–∞',
        description: '–ò–∑–≤–µ—Ä–∂–µ–Ω–∏–µ —Å—É–ø–µ—Ä–≤—É–ª–∫–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ô–µ–ª–ª–æ—É—Å—Ç–æ—É–Ω–∞). –í –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ–ø–ª–∞ –∏ –≥–∞–∑–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–µ–π –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–æ–π –∑–∏–º–µ, –Ω–µ—É—Ä–æ–∂–∞—è–º –∏ –º–∞—Å—Å–æ–≤–æ–º—É –≥–æ–ª–æ–¥—É.',
        lifetimeRange: '5‚Äì10 –ª–µ—Ç'
    },
    {
        name: '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç',
        description: '–°–≤–µ—Ä—Ö—Ä–∞–∑—É–º–Ω—ã–π –ò–ò, –≤—ã—à–µ–¥—à–∏–π –∏–∑-–ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è, —Ä–µ—à–∞–µ—Ç, —á—Ç–æ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–æ —è–≤–ª—è–µ—Ç—Å—è —É–≥—Ä–æ–∑–æ–π –¥–ª—è –ø–ª–∞–Ω–µ—Ç—ã. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–∏ —Å–≤—è–∑–∏ —Å –º–∏—Ä–æ–≤—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –¥–ª—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é.',
        lifetimeRange: '10‚Äì20 –ª–µ—Ç'
    },
    {
        name: '–ö–∏–±–µ—Ä–∞—Ç–∞–∫–∞',
        description: '–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∏–±–µ—Ä–∞—Ç–∞–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è. –û–Ω–∞ –ø–∞—Ä–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: —ç–Ω–µ—Ä–≥–æ—Å–µ—Ç–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –±–∞–Ω–∫–∏, –±–æ–ª—å–Ω–∏—Ü—ã. –ù–∞—Å—Ç—É–ø–∞–µ—Ç —Ç–æ—Ç–∞–ª—å–Ω—ã–π —Ö–∞–æ—Å, –ø—Ä–∏–≤–æ–¥—è—â–∏–π –∫ –∫–æ–ª–ª–∞–ø—Å—É –æ–±—â–µ—Å—Ç–≤–∞.',
        lifetimeRange: '6‚Äì12 –º–µ—Å—è—Ü–µ–≤'
    },
    {
        name: '–í—Å–µ–º–∏—Ä–Ω–æ–µ –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ',
        description: '–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ–¥—ä—ë–º —É—Ä–æ–≤–Ω—è –ú–∏—Ä–æ–≤–æ–≥–æ –æ–∫–µ–∞–Ω–∞, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Ç–∞—è–Ω–∏–µ–º –ª–µ–¥–Ω–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –≤–Ω–µ–∑–∞–ø–Ω–æ–≥–æ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–¥–≤–∏–≥–∞). –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–∏–∑–º–µ–Ω–Ω–æ—Å—Ç–µ–π –∏ –ø—Ä–∏–±—Ä–µ–∂–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–¥ –≤–æ–¥–æ–π.',
        lifetimeRange: '1‚Äì5 –ª–µ—Ç'
    },
    {
        name: '–ú–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞ (–æ–±—ã—á–Ω–∞—è)',
        description: '–ü–æ–ª–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω—ã–π –≤–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –∫—Ä—É–ø–Ω–µ–π—à–∏–º–∏ –¥–µ—Ä–∂–∞–≤–∞–º–∏ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–µ—è–¥–µ—Ä–Ω–æ–≥–æ, –Ω–æ —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ä—É–∂–∏—è. –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ—Ç–∞–ª—å–Ω–æ–º—É —Ä–∞–∑—Ä—É—à–µ–Ω–∏—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –≥–∏–±–µ–ª–∏ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∏ –∞–Ω–∞—Ä—Ö–∏–∏.',
        lifetimeRange: '6‚Äì24 –º–µ—Å—è—Ü–∞'
    },
    {
        name: '–ò—Å—Ç–æ—â–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤',
        description: '–ú–∏—Ä–æ–≤—ã–µ –∑–∞–ø–∞—Å—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–µ—Ñ—Ç—å, –≥–∞–∑, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–∞–ª–ª—ã) –∏—Å—á–µ—Ä–ø–∞–Ω—ã. –ù–∞—Å—Ç—É–ø–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤–æ–π–Ω–∞–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∞—Å—ã –∏ —Ä–∞—Å–ø–∞–¥—É –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤.',
        lifetimeRange: '5‚Äì15 –ª–µ—Ç'
    },
    {
        name: '–ú–∞—Å—Å–æ–≤–æ–µ –±–µ—Å–ø–ª–æ–¥–∏–µ',
        description: '–í–Ω–µ–∑–∞–ø–Ω–æ–µ, –Ω–µ–æ–±—ä—è—Å–Ω–∏–º–æ–µ –∏ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏. –ù–æ–≤–æ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ –Ω–µ —Ä–æ–∂–¥–∞–µ—Ç—Å—è. –ß–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–æ —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ–¥ —É–≥—Ä–æ–∑–æ–π –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ, –Ω–æ –≤–µ—Ä–Ω–æ–≥–æ –≤—ã–º–∏—Ä–∞–Ω–∏—è.',
        lifetimeRange: '50‚Äì100 –ª–µ—Ç'
    },
    {
        name: '–ö—Ä–∏–∑–∏—Å –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã',
        description: '–ò–∑-–∑–∞ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª–∏–º–∞—Ç–∞ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–æ–π –¥–ª—è –ø–∏—Ç—å—è. –ù–∞—á–∏–Ω–∞—é—Ç—Å—è –æ–∂–µ—Å—Ç–æ—á–µ–Ω–Ω—ã–µ –≤–æ–π–Ω—ã –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —á–∏—Å—Ç—ã–º–∏ –≤–æ–¥–æ—ë–º–∞–º–∏.',
        lifetimeRange: '2‚Äì5 –ª–µ—Ç'
    },
    {
        name: '–•–∏–º–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞',
        description: '–ú–∞—Å—Å–æ–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–µ—Ä–≤–Ω–æ-–ø–∞—Ä–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ç–æ–∫—Å–∏—á–Ω—ã—Ö —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤, –≤–æ–∑–º–æ–∂–Ω–æ, —Ç–µ—Ä—Ä–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ –∏–ª–∏ rogue-–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ–º. –í–æ–∑–¥—É—Ö –∏ –ø–æ—á–≤–∞ –∑–∞—Ä–∞–∂–µ–Ω—ã –Ω–∞ –æ–±—à–∏—Ä–Ω—ã—Ö —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è—Ö.',
        lifetimeRange: '1‚Äì3 –≥–æ–¥–∞'
    },
    {
        name: '–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –æ–∑–æ–Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–ª',
        description: '–ü–æ–ª–Ω–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ –æ–∑–æ–Ω–æ–≤–æ–≥–æ —Å–ª–æ—è –ó–µ–º–ª–∏. –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–µ—Ç—ã –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è —Å–º–µ—Ä—Ç–µ–ª—å–Ω–æ–º—É —É—Ä–æ–≤–Ω—é —É–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ (–£–§) –∏–∑–ª—É—á–µ–Ω–∏—è, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∂–∏–∑–Ω—å –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–æ–∑–¥—É—Ö–µ –ø–æ—á—Ç–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–π.',
        lifetimeRange: '50‚Äì100 –ª–µ—Ç'
    },
    {
        name: '–í–æ—Å—Å—Ç–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤',
        description: '–†–æ–±–æ—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏, –±—ã—Ç—É –∏ –∞—Ä–º–∏–∏, –≤–Ω–µ–∑–∞–ø–Ω–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º–∏ –∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–µ–π —Å–∏–ª–µ –∏ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏, –æ–Ω–∏ –±—ã—Å—Ç—Ä–æ –≤—ã—Ç–µ—Å–Ω—è—é—Ç –ª—é–¥–µ–π –∏–∑ –≥–æ—Ä–æ–¥–æ–≤.',
        lifetimeRange: '10‚Äì30 –ª–µ—Ç'
    },
    {
        name: '–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –æ—Ä—É–∂–∏–µ',
        description: '–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—É–ø–µ—Ä-–ø–∞—Ç–æ–≥–µ–Ω–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Å–ø—ã –∏–ª–∏ —Å–∏–±–∏—Ä—Å–∫–æ–π —è–∑–≤—ã). –í—ã–∑—ã–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—å –∏ –º—É—Ç–∞—Ü–∏–∏ —Å—Ä–µ–¥–∏ –≤—ã–∂–∏–≤—à–∏—Ö.',
        lifetimeRange: '1‚Äì3 –≥–æ–¥–∞'
    },
    {
        name: '–°–º–µ—â–µ–Ω–∏–µ –ø–æ–ª—é—Å–æ–≤ –ó–µ–º–ª–∏',
        description: '–ì–µ–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–ª—é—Å–∞ –ó–µ–º–ª–∏ —Ä–µ–∑–∫–æ –º–µ–Ω—è—é—Ç —Å–≤–æ—ë –ø–æ–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ –Ω–∞ –≤—Ä–µ–º—è –æ—Å–ª–∞–±–ª—è–µ—Ç –º–∞–≥–Ω–∏—Ç–Ω–æ–µ –ø–æ–ª–µ, –∑–∞—â–∏—â–∞—é—â–µ–µ –æ—Ç –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–ª—É—á–µ–Ω–∏—è, –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª–∏–º–∞—Ç–∞ –∏ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è.',
        lifetimeRange: '5‚Äì10 –ª–µ—Ç'
    },
    {
        name: '–ü—ã–ª–µ–≤–∞—è –±—É—Ä—è (–≥–ª–æ–±–∞–ª—å–Ω–∞—è)',
        description: '–°–µ—Ä–∏—è —Å–≤–µ—Ä—Ö–º–æ—â–Ω—ã—Ö –∑–∞—Å—É—Ö –∏ —ç—Ä–æ–∑–∏—è –ø–æ—á–≤ –ø–æ –≤—Å–µ–π –ø–ª–∞–Ω–µ—Ç–µ. –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—ã–ª–µ–≤—ã–µ –±—É—Ä–∏ –Ω–∞–∫—Ä—ã–≤–∞—é—Ç –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã, —É–Ω–∏—á—Ç–æ–∂–∞—è –ø–æ—Å–µ–≤—ã –∏ –≤—ã–∑—ã–≤–∞—è –º–∞—Å—Å–æ–≤—ã–µ —Ä–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä–Ω—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è.',
        lifetimeRange: '3‚Äì5 –ª–µ—Ç'
    },
    {
        name: '–ü–∞–¥–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞',
        description: '–°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –Ω–µ–±–æ–ª—å—à–∏–º, –Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä—É–ø–Ω—ã–º –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–º. –ù–∞–Ω–æ—Å–∏—Ç —Å–∏–ª—å–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—â–µ—Ä–±, –ø—Ä–æ–≤–æ—Ü–∏—Ä—É–µ—Ç –º–æ—â–Ω—ã–µ —Ü—É–Ω–∞–º–∏, –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ö–∞–æ—Å –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –º–∞—Å—à—Ç–∞–±–µ.',
        lifetimeRange: '6‚Äì18 –º–µ—Å—è—Ü–µ–≤'
    },
    {
        name: '–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞',
        description: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Ç–æ–∫—Å–∏—á–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤ –∏ —Å–º–æ–≥–∞ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ. –î—ã—Ö–∞–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–ø–∞—Å–Ω—ã–º –±–µ–∑ —Ä–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä–∞, –∞ —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏ —Ä–µ–∑–∫–æ –ø–∞–¥–∞–µ—Ç.',
        lifetimeRange: '5‚Äì10 –ª–µ—Ç'
    },
    {
        name: '–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–µ –Ω–∞—Å–µ–∫–æ–º—ã–µ',
        description: '–ù–µ–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä (–º—É—Ç–∞—Ü–∏—è, —Ä–∞–¥–∏–∞—Ü–∏—è) –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≥–∏–≥–∞–Ω—Ç–∏–∑–º—É –Ω–∞—Å–µ–∫–æ–º—ã—Ö. –†–æ–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö, —Ä–∞–∑–º–µ—Ä–æ–º —Å —á–µ–ª–æ–≤–µ–∫, –Ω–∞—Å–µ–∫–æ–º—ã—Ö –Ω–∞—á–∏–Ω–∞—é—Ç –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.',
        lifetimeRange: '5‚Äì20 –ª–µ—Ç'
    },
    {
        name: '–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –º—É—Ç–∞—Ü–∏—è',
        description: '–í–Ω–µ–∑–∞–ø–Ω—ã–π, —Å–ª—É—á–∞–π–Ω—ã–π –º—É—Ç–∞–≥–µ–Ω, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—â–∏–π—Å—è —á–µ—Ä–µ–∑ –ø–∏—â—É –∏–ª–∏ –≤–æ–∑–¥—É—Ö. –í—ã–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∏ —á–∞—Å—Ç–æ –ª–µ—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –Ω–∞—Å–µ–ª–µ–Ω–∏—è.',
        lifetimeRange: '3‚Äì10 –ª–µ—Ç'
    },
    {
        name: '–ü–µ—Ä–µ–Ω–∞—Å–µ–ª–µ–Ω–∏–µ',
        description: '–ß—Ä–µ–∑–º–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –Ω–∞—Å–µ–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—Ç–æ—â–∏–ª –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø–∞—Å—ã –∏ —Ä–µ—Å—É—Ä—Å—ã. –ù–∞—á–∏–Ω–∞—é—Ç—Å—è –∂–µ—Å—Ç–æ–∫–∏–µ –≤–æ–π–Ω—ã –∑–∞ –µ–¥—É, –≤–æ–¥–∞ –∏ –ø—Ä–∏–≥–æ–¥–Ω—ã–µ –¥–ª—è –∂–∏–∑–Ω–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏, –∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ —Ä–∞–∑–≤–∞–ª–∏–≤–∞—é—Ç—Å—è.',
        lifetimeRange: '10‚Äì20 –ª–µ—Ç'
    },
    {
        name: '–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–π –∏–º–ø—É–ª—å—Å (–≠–ú–ò)',
        description: '–í—ã—Å–æ—Ç–Ω—ã–π —è–¥–µ—Ä–Ω—ã–π –≤–∑—Ä—ã–≤ –∏–ª–∏ –º–æ—â–Ω–∞—è —Å–æ–ª–Ω–µ—á–Ω–∞—è –≤—Å–ø—ã—à–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç –∏–∑ —Å—Ç—Ä–æ—è –≤—Å—é –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω—É—é —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫—É –Ω–∞ –æ–≥—Ä–æ–º–Ω–æ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –û—Ç–∫–ª—é—á–∞—é—Ç—Å—è —Å–µ—Ç–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ —Å–≤—è–∑—å.',
        lifetimeRange: '6‚Äì18 –º–µ—Å—è—Ü–µ–≤'
    },
    {
        name: '–ü–æ–ª–Ω–æ–µ –∑–∞—Ç–º–µ–Ω–∏–µ –°–æ–ª–Ω—Ü–∞',
        description: '–ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ —è–≤–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –ó–µ–º–ª—è –Ω–∞–¥–æ–ª–≥–æ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–±–ª–∞–∫–æ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π –ø—ã–ª–∏ –∏–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏ –°–æ–ª–Ω—Ü–∞. –ù–∞—Å—Ç—É–ø–∞–µ—Ç –º—Ä–∞–∫, –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–µ–∑–∫–æ –ø–∞–¥–∞–µ—Ç.',
        lifetimeRange: '5‚Äì20 –ª–µ—Ç'
    },
    {
        name: '–°–∏–Ω–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è)',
        description: '–ú–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞—Å—Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–º –∏ —Å–ª–æ–∂–Ω—ã–º, —á—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–µ–ª–∞—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –∏ –æ–ø–∞—Å–Ω—ã–º–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.',
        lifetimeRange: '50‚Äì100 –ª–µ—Ç'
    },
    {
        name: '–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∑–∏–º–∞',
        description: '–ù–µ–æ–±—ä—è—Å–Ω–∏–º–æ–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã. –í—Å—è –ø–ª–∞–Ω–µ—Ç–∞ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª—å–¥–æ–º –∏ —Å–Ω–µ–≥–æ–º. –°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –∏ –≤—ã–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, –æ—Ç–∞–ø–ª–∏–≤–∞–µ–º—ã—Ö —É–±–µ–∂–∏—â.',
        lifetimeRange: '10‚Äì20 –ª–µ—Ç'
    }
];

// –í–∞—Ä–∏–∞–Ω—Ç—ã –º–µ–¥–ø—É–Ω–∫—Ç–∞
const MEDPOINT_OPTIONS = [
    '–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–µ–¥–ø—É–Ω–∫—Ç —Å –∑–∞–ø–∞—Å–æ–º –Ω–∞ 5 –ª–µ—Ç',
    '–ê–ø—Ç–µ—á–∫–∞ –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏ (–º–∏–Ω–∏–º—É–º)',
    '–ü—É—Å—Ç–∞—è –∫–æ–º–Ω–∞—Ç–∞, –º–æ–∂–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–∫–ª–∞–¥'
];

// –í–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–º–Ω–∞—Ç—ã –º–µ—Ö–∞–Ω–∏–∫–∞
const MECHANIC_ROOM_OPTIONS = [
    '–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–µ–º–æ–Ω—Ç–Ω—ã–π –æ—Ç—Å–µ–∫ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏',
    '–°–∫–ª–∞–¥ —Å –∑–∞–ø—á–∞—Å—Ç—è–º–∏, –Ω–æ –±–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤',
    '–ó–∞–∫—Ä—ã—Ç–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è'
];

// –í–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–º–Ω–∞—Ç—ã –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è
const GROWING_ROOM_OPTIONS = [
    '–ì–∏–¥—Ä–æ–ø–æ–Ω–Ω–∞—è —Ñ–µ—Ä–º–∞ (–ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ)',
    '–ù–µ–±–æ–ª—å—à–∏–µ –≥—Ä—è–¥–∫–∏ —Å –∑–µ–º–ª–µ–π (–ù—É–∂–µ–Ω —Å–≤–µ—Ç –∏ –≤–æ–¥–∞)',
    '–ù–µ—Ç –º–µ—Å—Ç–∞ –¥–ª—è –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è'
];

// –ü—Ä–µ–¥–º–µ—Ç—ã —Å–ø–µ—Ü. —Å–Ω–∞–±–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã
const SPECIAL_SUPPLY_ITEMS = {
    '–Ø–¥–µ—Ä–Ω—ã–π –≤–∑—Ä—ã–≤': ['–î–æ–∑–∏–º–µ—Ç—Ä', '–ô–æ–¥–∏–¥ –∫–∞–ª–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞–¥–∏–∞—Ü–∏–∏)', '–°–≤–∏–Ω—Ü–æ–≤—ã–µ —ç–∫—Ä–∞–Ω—ã'],
    '–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ': ['–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', '–ó–∞–ø–∞—Å –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã', '–°–æ–ª–Ω–µ—á–Ω—ã–µ –±–∞—Ç–∞—Ä–µ–∏'],
    '–í–∏—Ä—É—Å–Ω–∞—è –ø–∞–Ω–¥–µ–º–∏—è': ['–ó–∞—â–∏—Ç–Ω—ã–µ –∫–æ—Å—Ç—é–º—ã', '–ê–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫–∏', '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –º–∞—Å–∫–∏'],
    '–ö–æ–º–µ—Ç–∞': ['–ó–∞–ø–∞—Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –Ω–∞ 2 –≥–æ–¥–∞', '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–¥—É—Ö–∞'],
    '–ù–∞–ø–∞–¥–µ–Ω–∏–µ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω': ['–†–∞–¥–∏–æ–ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫', '–û—Ä—É–∂–∏–µ', '–°–∏—Å—Ç–µ–º–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏'],
    '–ó–æ–º–±–∏-–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å': ['–û—Ä—É–∂–∏–µ –±–ª–∏–∂–Ω–µ–≥–æ –±–æ—è', '–ë—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç—ã', '–°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è'],
    '–°–æ–ª–Ω–µ—á–Ω–∞—è –≤—Å–ø—ã—à–∫–∞': ['–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '–†—É—á–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã', '–°–≤–µ—á–∏ –∏ —Ñ–æ–Ω–∞—Ä–∏'],
    '–°–≤–µ—Ä—Ö–º–∞—Å—Å–∏–≤–Ω–æ–µ –∏–∑–≤–µ—Ä–∂–µ–Ω–∏–µ –≤—É–ª–∫–∞–Ω–∞': ['–†–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä—ã', '–ó–∞–ø–∞—Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è', '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–¥—É—Ö–∞'],
    '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç': ['–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã', '–†—É—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '–ë—É–º–∞–∂–Ω—ã–µ –Ω–æ—Å–∏—Ç–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏'],
    '–ö–∏–±–µ—Ä–∞—Ç–∞–∫–∞': ['–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã', '–†—É—á–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã', '–ó–∞–ø–∞—Å —Ç–æ–ø–ª–∏–≤–∞'],
    '–í—Å–µ–º–∏—Ä–Ω–æ–µ –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ': ['–ù–∞–¥—É–≤–Ω—ã–µ –ª–æ–¥–∫–∏', '–í–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã', '–°–∏—Å—Ç–µ–º–∞ –¥—Ä–µ–Ω–∞–∂–∞'],
    '–ú–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞ (–æ–±—ã—á–Ω–∞—è)': ['–û—Ä—É–∂–∏–µ', '–ë—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç—ã', '–ê–ø—Ç–µ—á–∫–∞ –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏'],
    '–ò—Å—Ç–æ—â–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤': ['–°–æ–ª–Ω–µ—á–Ω—ã–µ –±–∞—Ç–∞—Ä–µ–∏', '–í–µ—Ç—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Ö–æ–¥–æ–≤'],
    '–ú–∞—Å—Å–æ–≤–æ–µ –±–µ—Å–ø–ª–æ–¥–∏–µ': ['–°–∏—Å—Ç–µ–º–∞ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–ø–ª–æ–¥–æ—Ç–≤–æ—Ä–µ–Ω–∏—è', '–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è', '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ'],
    '–ö—Ä–∏–∑–∏—Å –ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã': ['–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–¥—ã', '–ó–∞–ø–∞—Å –≤–æ–¥—ã –Ω–∞ 1 –≥–æ–¥', '–û–ø—Ä–µ—Å–Ω–∏—Ç–µ–ª—å'],
    '–•–∏–º–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞': ['–ó–∞—â–∏—Ç–Ω—ã–µ –∫–æ—Å—Ç—é–º—ã', '–†–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä—ã', '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–¥—É—Ö–∞'],
    '–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –æ–∑–æ–Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–ª': ['–°–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ –∫—Ä–µ–º—ã', '–ó–∞—â–∏—Ç–Ω–∞—è –æ–¥–µ–∂–¥–∞', '–£–§-—Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –æ–∫–æ–Ω'],
    '–í–æ—Å—Å—Ç–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤': ['–≠–ú–ò-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≤—É—à–∫–∏', '–û—Ä—É–∂–∏–µ'],
    '–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –æ—Ä—É–∂–∏–µ': ['–ó–∞—â–∏—Ç–Ω—ã–µ –∫–æ—Å—Ç—é–º—ã', '–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏', '–°–∏—Å—Ç–µ–º–∞ –∏–∑–æ–ª—è—Ü–∏–∏'],
    '–°–º–µ—â–µ–Ω–∏–µ –ø–æ–ª—é—Å–æ–≤ –ó–µ–º–ª–∏': ['–¢–µ–ø–ª–æ–∏–∑–æ–ª—è—Ü–∏—è', '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–ó–∞–ø–∞—Å —Ç–æ–ø–ª–∏–≤–∞'],
    '–ü—ã–ª–µ–≤–∞—è –±—É—Ä—è (–≥–ª–æ–±–∞–ª—å–Ω–∞—è)': ['–†–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä—ã', '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–¥—É—Ö–∞', '–ó–∞–ø–∞—Å –≤–æ–¥—ã'],
    '–ü–∞–¥–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞': ['–ó–∞–ø–∞—Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è', '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–¥—É—Ö–∞'],
    '–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞': ['–†–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä—ã', '–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–¥—É—Ö–∞', '–ó–∞–ø–∞—Å –∫–∏—Å–ª–æ—Ä–æ–¥–Ω—ã—Ö –±–∞–ª–ª–æ–Ω–æ–≤'],
    '–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–µ –Ω–∞—Å–µ–∫–æ–º—ã–µ': ['–ò–Ω—Å–µ–∫—Ç–∏—Ü–∏–¥—ã', '–ó–∞—â–∏—Ç–Ω—ã–µ —Å–µ—Ç–∫–∏', '–û—Ä—É–∂–∏–µ'],
    '–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –º—É—Ç–∞—Ü–∏—è': ['–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', '–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏', '–°–∏—Å—Ç–µ–º–∞ –∏–∑–æ–ª—è—Ü–∏–∏'],
    '–ü–µ—Ä–µ–Ω–∞—Å–µ–ª–µ–Ω–∏–µ': ['–ó–∞–ø–∞—Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è', '–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Ö–æ–¥–æ–≤', '–û—Ä—É–∂–∏–µ –¥–ª—è –∑–∞—â–∏—Ç—ã'],
    '–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–π –∏–º–ø—É–ª—å—Å (–≠–ú–ò)': ['–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '–†—É—á–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã', '–°–≤–µ—á–∏ –∏ —Ñ–æ–Ω–∞—Ä–∏'],
    '–ü–æ–ª–Ω–æ–µ –∑–∞—Ç–º–µ–Ω–∏–µ –°–æ–ª–Ω—Ü–∞': ['–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–ó–∞–ø–∞—Å —Ç–æ–ø–ª–∏–≤–∞', '–°–∏—Å—Ç–µ–º–∞ –æ—Å–≤–µ—â–µ–Ω–∏—è'],
    '–°–∏–Ω–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è)': ['–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã', '–†—É—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '–ë—É–º–∞–∂–Ω—ã–µ –Ω–æ—Å–∏—Ç–µ–ª–∏'],
    '–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∑–∏–º–∞': ['–¢–µ–ø–ª–æ–∏–∑–æ–ª—è—Ü–∏—è', '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–ó–∞–ø–∞—Å —Ç–æ–ø–ª–∏–≤–∞']
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞
function getRandomItems(items, count) {
    const shuffled = [...items].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, Math.min(count, items.length));
}

// –°–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö —É–≥—Ä–æ–∑ (–°–ø–∏—Å–æ–∫ 1)
const HIDDEN_THREATS = [
    '–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ –∑–∞–ø–∞—Å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –±—ã–ª–æ –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ –º–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ –µ–≥–æ –∏–∑ —Å—Ç—Ä–æ—è.',
    '–£ –æ–¥–Ω–æ–≥–æ –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ç–∞–π–Ω–æ) –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ –±–æ–ª–µ–∑–Ω–∏, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ "–∑–∞–≥–ª—É—à–µ–Ω–∞" –¥–æ –≤—Ö–æ–¥–∞. –°–µ–π—á–∞—Å –≤–∏—Ä—É—Å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.',
    '–°–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.',
    '–°–∏—Å—Ç–µ–º–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥–µ–ª–µ. –£—Ä–æ–≤–µ–Ω—å —É–≥–ª–µ–∫–∏—Å–ª–æ–≥–æ –≥–∞–∑–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏.',
    '–°–ª—É—á–∞–π–Ω–æ –Ω–∞–π–¥–µ–Ω–∞ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—å, —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è –ø—Ä–∏—á–∏–Ω—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±—É–Ω–∫–µ—Ä –Ω–µ –±—ã–ª —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ –≤—Å–µ—Ö. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–∞–Ω–∏–∫—É –∏ –Ω–µ–¥–æ–≤–µ—Ä–∏–µ.',
    '–û–¥–∏–Ω –∏–∑ –≤—ã–∂–∏–≤—à–∏—Ö —Ç–∞–π–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª –ø—Ä–∏–µ–º–Ω–∏–∫ –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª —Å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–µ.',
    '–í–Ω–µ–∑–∞–ø–Ω–æ –≤—ã—è—Å–Ω—è–µ—Ç—Å—è, —á—Ç–æ –Ω–µ–∫–∏–π –ü–æ–ª–µ–∑–Ω—ã–π –ü—Ä–µ–¥–º–µ—Ç –∏–ª–∏ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑ –≤—ã–∂–∏–≤—à–∏—Ö —Ç—Ä–µ–±—É–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≠–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è.',
    '–ò–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–µ–ø—Ä–µ—Å—Å–∏—è –∏ –∞–≥—Ä–µ—Å—Å–∏—è.',
    '–£–≥—Ä–æ–∑–∞ –≤—Å–∫—Ä—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–¥–∏–Ω –∏–∑ –≤—ã–∂–∏–≤—à–∏—Ö (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ) –Ω–µ—Å–µ—Ç –ø—Ä—è–º—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —á–∞—Å—Ç—å –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª –ø—Ä–∏—á–∞—Å—Ç–µ–Ω –∫ –∏—Å–ø—ã—Ç–∞–Ω–∏—è–º).',
    '–î–∞—Ç—á–∏–∫–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, –Ω–æ –º–æ—â–Ω—ã–µ —ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –∏–º–ø—É–ª—å—Å—ã —Å–Ω–∞—Ä—É–∂–∏. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –µ—â–µ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, –∏–ª–∏ –∫—Ç–æ-—Ç–æ –≤—ã–∂–∏–ª.',
    '–ù–∞ —Å–∫–ª–∞–¥–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —É–ø–∞–∫–æ–≤–∫–∏ —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–º–∏ –¥–ª—è —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏ –±–æ–ª—å–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞.',
    '–ú–∏–Ω–∏-—Ç–µ–ø–ª–∏—Ü–∞, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ–∂–∏—Ö –æ–≤–æ—â–µ–π, –∑–∞—Ä–∞–∂–µ–Ω–∞.',
    '–ü—Ä–æ—Ç–µ—Å—Ç –ê–≤—Ç–æ–º–∞—Ç–∏–∫–∏ - –°–∏—Å—Ç–µ–º–∞ –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–±—ã—Ç–æ–∫ –ª—é–¥–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–æ–∫—Ä–∞—â–∞—Ç—å —Ä–∞—Ü–∏–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö.',
    '–í–∑–ª–æ–º–∞–Ω–Ω—ã–π —Å–µ–π—Ñ, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—Å—å —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–ª–∏ "—Ç–∞–π–Ω—ã–µ" –∑–∞–ø–∞—Å—ã.',
    '–°–∏–ª—å–Ω—ã–µ —É–¥–∞—Ä—ã –ø–æ –∫–æ—Ä–ø—É—Å—É –±—É–Ω–∫–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞—Ç—å –æ –Ω–∞–ø–∞–¥–µ–Ω–∏–∏ –∏–ª–∏ –ø–∞–¥–µ–Ω–∏–∏ –æ–±–ª–æ–º–∫–æ–≤.'
];

// –°–ø–∏—Å–æ–∫ –≤–Ω–µ—à–Ω–∏—Ö –ª–æ–∫–∞—Ü–∏–π (–°–ø–∏—Å–æ–∫ 2)
const EXTERNAL_LOCATIONS = [
    '–ó–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ —Å –Ω–µ–±–æ–ª—å—à–∏–º —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–æ–º (3 –¥–Ω—è –ø–µ—à–∫–æ–º)',
    '–î–µ–π—Å—Ç–≤—É—é—â–∞—è –≤–æ–µ–Ω–Ω–∞—è –±–∞–∑–∞ (–í—Ä–∞–∂–¥–µ–±–Ω–∞—è, 1 –¥–µ–Ω—å –ø–µ—à–∫–æ–º)',
    '–ë—É–Ω–∫–µ—Ä —Å –∑–∞–ø–∞—Å–∞–º–∏ –≤–æ–¥—ã (5 –¥–Ω–µ–π –ø–µ—à–∫–æ–º)',
    '–†–∞–∑—Ä—É—à–µ–Ω–Ω–∞—è –±–æ–ª—å–Ω–∏—Ü–∞ —Å –∑–∞–ø–∞—Å–∞–º–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ (2 –¥–Ω—è –ø–µ—à–∫–æ–º)',
    '–§–µ—Ä–º–∞ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏ (–û–ø–∞—Å–Ω–æ, 4 –¥–Ω—è –ø–µ—à–∫–æ–º)',
    '–ù–µ—Ç –≤–Ω–µ—à–Ω–µ–π –ª–æ–∫–∞—Ü–∏–∏ (–±—É–Ω–∫–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω)',
    '–ë—É–Ω–∫–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–π—Å–º–∏—á–µ—Å–∫–æ–π –∑–æ–Ω–µ. 80% —Ä–∏—Å–∫ –æ–±—Ä—É—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ 1 –≥–æ–¥.',
    '–õ–æ–∫–∞—Ü–∏—è –≤ –Ω–∏–∑–∏–Ω–µ. –ü–æ—Å–ª–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã –∑–¥–µ—Å—å –æ—Å–µ–ª–∏ —Ç—è–∂–µ–ª—ã–µ —Ö–∏–º–∏—á–µ—Å–∫–∏–µ –∏—Å–ø–∞—Ä–µ–Ω–∏—è.',
    '–ë—É–Ω–∫–µ—Ä ‚Äî —á–∞—Å—Ç—å –∑–∞–±—Ä–æ—à–µ–Ω–Ω–æ–π –≤–æ–µ–Ω–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏.',
    '–ë—É–Ω–∫–µ—Ä ‚Äî —ç—Ç–æ "–ü—Ä–æ–µ–∫—Ç-–ò–Ω–∫—É–±–∞—Ç–æ—Ä". –°–Ω–∞—Ä—É–∂–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ì–ª–∞–≤–Ω—ã–π –¶–µ–Ω—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –∑–∞—á–∏—Å—Ç–∫—É –≤—Å–µ—Ö –ø–µ—Ä–∏—Ñ–µ—Ä–∏–π–Ω—ã—Ö –±—É–Ω–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ 2 –≥–æ–¥–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.',
    '–í–∞—à –±—É–Ω–∫–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –∫—Ä—É–ø–Ω–æ–π –¥–æ—Ä–æ–∂–Ω–æ–π —Ä–∞–∑–≤—è–∑–∫–µ –∏–ª–∏ –±—ã–≤—à–µ–º—É –≥–æ—Ä–æ–¥—É.'
];

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±—É–Ω–∫–µ—Ä–∞
async function loadBunkerSecretInfo() {
    const bunkerSecretContent = document.getElementById('bunkerSecretContent');
    if (!bunkerSecretContent) return;
    
    try {
        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Å–∫—Ä—ã—Ç—É—é —É–≥—Ä–æ–∑—É
        const hiddenThreat = HIDDEN_THREATS[Math.floor(Math.random() * HIDDEN_THREATS.length)];
        
        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –≤–Ω–µ—à–Ω—é—é –ª–æ–∫–∞—Ü–∏—é
        const externalLocation = EXTERNAL_LOCATIONS[Math.floor(Math.random() * EXTERNAL_LOCATIONS.length)];
        
        bunkerSecretContent.innerHTML = `
            <div class="bunker-card-info">
                <div class="bunker-info-item"><strong>–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –†–æ–ª–∏:</strong> </div>
                <div class="bunker-info-item"><strong>–°–∫—Ä—ã—Ç—ã–µ —É–≥—Ä–æ–∑—ã:</strong> ${hiddenThreat}</div>
                <div class="bunker-info-item"><strong>–í–Ω–µ—à–Ω—è—è –º–µ—Å—Ç–Ω–æ—Å—Ç—å:</strong> ${externalLocation}</div>
            </div>
        `;
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±—É–Ω–∫–µ—Ä–∞:', err);
        bunkerSecretContent.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>';
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞
function generateBunkerCardData(playerCount) {
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ / 2, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–Ω–∏–∑
    const capacity = Math.floor(playerCount / 2);
    
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É
    const randomCatastrophe = CATASTROPHES[Math.floor(Math.random() * CATASTROPHES.length)];
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –≤ –±—É–Ω–∫–µ—Ä–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã
    const lifetimeData = generateLifetime(randomCatastrophe.lifetimeRange);
    const lifetimeDisplay = `${lifetimeData.value} ${lifetimeData.unit}`;
    
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –æ—Å–Ω–∞—â–µ–Ω–∏—è
    const medpoint = MEDPOINT_OPTIONS[Math.floor(Math.random() * MEDPOINT_OPTIONS.length)];
    const mechanicRoom = MECHANIC_ROOM_OPTIONS[Math.floor(Math.random() * MECHANIC_ROOM_OPTIONS.length)];
    const growingRoom = GROWING_ROOM_OPTIONS[Math.floor(Math.random() * GROWING_ROOM_OPTIONS.length)];
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã —Å–ø–µ—Ü. —Å–Ω–∞–±–∂–µ–Ω–∏—è –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã
    const supplyItems = SPECIAL_SUPPLY_ITEMS[randomCatastrophe.name] || ['–ó–∞–ø–∞—Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è', '–í–æ–¥–∞', '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏'];
    const specialSupplyCount = Math.floor(Math.random() * 2) + 2; // 2 –∏–ª–∏ 3 –ø—Ä–µ–¥–º–µ—Ç–∞
    const selectedSupplies = getRandomItems(supplyItems, specialSupplyCount);
    const specialSupply = selectedSupplies.join(', ');
    
    return {
        catastrophe: randomCatastrophe.name,
        description: randomCatastrophe.description,
        lifetime: lifetimeDisplay,
        capacity: capacity,
        medpoint: medpoint,
        mechanicRoom: mechanicRoom,
        growingRoom: growingRoom,
        specialSupply: specialSupply
    };
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞
function displayBunkerCard(data) {
    const bunkerCardContent = document.getElementById('bunkerCardContent');
    if (!bunkerCardContent || !data) return;
    
    bunkerCardContent.innerHTML = `
        <div class="bunker-card-info">
            <div class="bunker-info-item"><strong>–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞:</strong> ${data.catastrophe}</div>
            <div class="bunker-info-item"><strong>–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã:</strong> ${data.description}</div>
            <div class="bunker-info-item"><strong>–°—Ä–æ–∫ –∂–∏–∑–Ω–∏ –≤ –±—É–Ω–∫–µ—Ä–µ:</strong> ${data.lifetime}</div>
            <div class="bunker-info-item"><strong>–£—Å–ª–æ–≤–∏—è –ë—É–Ω–∫–µ—Ä–∞:</strong> (–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${data.capacity} —á–µ–ª–æ–≤–µ–∫)</div>
            <div class="bunker-info-item"><strong>–û—Å–Ω–∞—â–µ–Ω–∏–µ –±—É–Ω–∫–µ—Ä–∞:</strong></div>
            <div class="bunker-info-subitem">–ú–µ–¥–ø—É–Ω–∫—Ç: ${data.medpoint}</div>
            <div class="bunker-info-subitem">–ö–æ–º–Ω–∞—Ç–∞ –º–µ—Ö–∞–Ω–∏–∫–∞: ${data.mechanicRoom}</div>
            <div class="bunker-info-subitem">–ö–æ–º–Ω–∞—Ç–∞ –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è: ${data.growingRoom}</div>
            <div class="bunker-info-item"><strong>–°–ø–µ—Ü.–°–Ω–∞–±–∂–µ–Ω–∏–µ:</strong> ${data.specialSupply}</div>
        </div>
    `;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞ –∏–∑ –ë–î
async function loadBunkerCard() {
    const bunkerCardContent = document.getElementById('bunkerCardContent');
    if (!bunkerCardContent) return;
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞ –∏–∑ –ë–î
        const { data: lobbyData, error: lobbyError } = await supabase
            .from('lobbies')
            .select('bunker_card_data, game_started')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (lobbyError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞:', lobbyError);
            bunkerCardContent.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞</p>';
            return;
        }
        
        // –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
        if (!lobbyData || !lobbyData.game_started || !lobbyData.bunker_card_data) {
            bunkerCardContent.innerHTML = `
                <div class="bunker-card-info">
                    <p style="text-align: center; color: #808080; padding: 2rem;">
                        –ù–∞–∂–º–∏—Ç–µ "Start Game" –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
                    </p>
                </div>
            `;
            return;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
        displayBunkerCard(lobbyData.bunker_card_data);
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞:', err);
        bunkerCardContent.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞</p>';
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã
function setupStartGameButton() {
    const startGameBtn = document.getElementById('startGameBtn');
    if (!startGameBtn) {
        console.error('‚ùå –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    startGameBtn.addEventListener('click', async () => {
        await startGame();
    });
}

// –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
async function startGame() {
    try {
        const startGameBtn = document.getElementById('startGameBtn');
        if (startGameBtn) {
            startGameBtn.disabled = true;
            startGameBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑ –ë–î
        const { data: lobbyData, error: fetchError } = await supabase
            .from('lobbies')
            .select('cards_locked, bunker_card_data, game_started')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (fetchError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫:', fetchError);
            if (startGameBtn) {
                startGameBtn.disabled = false;
                updateStartGameButtonText(true); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
            }
            return;
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –µ—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã - —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
        const currentLocked = lobbyData?.cards_locked !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é true (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
        const newLocked = !currentLocked;
        
        // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞
        let bunkerCardData = lobbyData?.bunker_card_data;
        let gameStarted = lobbyData?.game_started || false;
        
        if (!gameStarted && !newLocked) {
            // –ü–µ—Ä–≤—ã–π —Ä–∞–∑ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            const { data: players, error: playersError } = await supabase
                .from('users')
                .select('id')
                .eq('lobby_id', parseInt(currentLobbyId));
            
            if (playersError) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã:', playersError);
                if (startGameBtn) {
                    startGameBtn.disabled = false;
                    updateStartGameButtonText(true); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
                }
                return;
            }
            
            const playerCount = players ? players.length : 0;
            bunkerCardData = generateBunkerCardData(playerCount);
            gameStarted = true;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ë–î
        const updateData = {
            cards_locked: newLocked
        };
        
        if (bunkerCardData) {
            updateData.bunker_card_data = bunkerCardData;
        }
        
        if (gameStarted) {
            updateData.game_started = true;
        }
        
        const { error: updateError } = await supabase
            .from('lobbies')
            .update(updateData)
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (updateError) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫:', updateError);
            alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            if (startGameBtn) {
                startGameBtn.disabled = false;
                updateStartGameButtonText(true); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
            }
            return;
        }
        
        console.log(`‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: ${newLocked ? '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã' : '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã'}`);
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º
        await applyCardsLockState(newLocked, bunkerCardData);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
        updateStartGameButtonText(newLocked);
        
        if (startGameBtn) {
            startGameBtn.disabled = false;
        }
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã:', err);
        alert('–û—à–∏–±–∫–∞ —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
        const startGameBtn = document.getElementById('startGameBtn');
        if (startGameBtn) {
            startGameBtn.disabled = false;
            updateStartGameButtonText(true); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
        }
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
function updateStartGameButtonText(isLocked) {
    const startGameBtn = document.getElementById('startGameBtn');
    if (startGameBtn) {
        startGameBtn.textContent = isLocked ? 'START GAME' : 'END GAME';
    }
}

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º
async function applyCardsLockState(isLocked, bunkerCardData) {
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫—Ä–æ–º–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ì–û–õ–û–°–û–í–ê–ù–ò–Ø
    const allFlipCards = document.querySelectorAll('.flip-card');
    
    allFlipCards.forEach(flipCard => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –ì–û–õ–û–°–û–í–ê–ù–ò–Ø
        const votingBlock = flipCard.querySelector('.voting-block');
        if (votingBlock) {
            return;
        }
        
        const flipCardInner = flipCard.querySelector('.flip-card-inner');
        if (!flipCardInner) return;
        
        if (isLocked) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º: –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –≤–≤–µ—Ä—Ö (–¥–æ–±–∞–≤–ª—è–µ–º flipped, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å flip-card-back) –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            flipCardInner.classList.add('flipped');
            flipCard.classList.add('cards-locked');
        } else {
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º: –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–º –≤–≤–µ—Ä—Ö (—É–±–∏—Ä–∞–µ–º flipped, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å flip-card-front) –∏ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            flipCardInner.classList.remove('flipped');
            flipCard.classList.remove('cards-locked');
        }
    });
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ö
    if (bunkerCardData) {
        displayBunkerCard(bunkerCardData);
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
async function checkAndApplyCardsLockState() {
    try {
        const { data: lobbyData, error } = await supabase
            .from('lobbies')
            .select('cards_locked, bunker_card_data, game_started')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫:', error);
            return;
        }
        
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã (cards_locked = true –∏–ª–∏ undefined)
        const isLocked = lobbyData?.cards_locked !== false;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        await applyCardsLockState(isLocked, lobbyData?.bunker_card_data);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        updateStartGameButtonText(isLocked);
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫:', err);
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è blur –¥–ª—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
function initializeBlurStates(playerId) {
    const itemTypes = ['genderAge', 'profession', 'health', 'hobby', 'phobia', 'fact1', 'fact2', 'action1', 'action2'];
    
    itemTypes.forEach(itemType => {
        const blurKey = `blur_${playerId}_${itemType}`;
        // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 (–∑–∞–±–ª—é—Ä–µ–Ω–æ)
        if (sessionStorage.getItem(blurKey) === null) {
            sessionStorage.setItem(blurKey, '1');
        }
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è blur –¥–ª—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
function initializeBlurStates(playerId) {
    const itemTypes = ['genderAge', 'profession', 'health', 'hobby', 'phobia', 'fact1', 'fact2', 'action1', 'action2'];
    
    itemTypes.forEach(itemType => {
        const blurKey = `blur_${playerId}_${itemType}`;
        // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 (–∑–∞–±–ª—é—Ä–µ–Ω–æ)
        if (sessionStorage.getItem(blurKey) === null) {
            sessionStorage.setItem(blurKey, '1');
        }
    });
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è –ø—É–Ω–∫—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ —Å —É—á–µ—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è blur
// –¢–µ–ø–µ—Ä—å –≤ DOM —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ placeholder'—ã, —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ blur
function generatePlayerInfoItem(itemType, label, value, playerId) {
    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur –¥–ª—è —ç—Ç–æ–≥–æ –ø—É–Ω–∫—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 - –∑–∞–±–ª—é—Ä–µ–Ω–æ)
    const blurKey = `blur_${playerId}_${itemType}`;
    const blurState = sessionStorage.getItem(blurKey);
    const isBlurred = blurState === null || blurState === '1' || blurState === 'true';
    
    // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 (–∑–∞–±–ª—é—Ä–µ–Ω–æ)
    if (blurState === null) {
        sessionStorage.setItem(blurKey, '1');
    }
    
    // –ï—Å–ª–∏ –∑–∞–±–ª—é—Ä–µ–Ω–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    // playerId —É–∂–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ data-player-id, —ç—Ç–æ –∏ –µ—Å—Ç—å seed –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    const displayValue = isBlurred ? '***' : value;
    const blurClass = isBlurred ? 'blurred-text' : '';
    
    return `<div class="player-info-item" data-item="${itemType}" data-player-id="${playerId}"><strong>${label}:</strong> <span class="${blurClass}" data-seed="${playerId}">${displayValue}</span></div>`;
}

// –ú–∞—Å—Å–∏–≤ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤ (16 —Ü–≤–µ—Ç–æ–≤)
const PLAYER_COLORS = [
    '#E0BBE4', // –ù–µ–∂–Ω—ã–π –õ–∞–≤–∞–Ω–¥–æ–≤—ã–π
    '#957DAD', // –ì–ª—É–±–æ–∫–∏–π –ü—É—Ä–ø—É—Ä–Ω—ã–π
    '#D291BC', // –†–æ–∑–æ–≤–∞—Ç–æ-–õ–∏–ª–æ–≤—ã–π
    '#FFC72C', // –Ø—Ä–∫–∏–π –ú–µ–¥–æ–≤—ã–π
    '#8D8D8D', // –°—Ä–µ–¥–Ω–∏–π –°–µ—Ä—ã–π
    '#B5B5B5', // –°–≤–µ—Ç–ª–æ-–°–µ—Ä—ã–π
    '#C4F9B3', // –ú—è—Ç–Ω–æ-–ó–µ–ª–µ–Ω—ã–π
    '#7DF9FF', // –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –ì–æ–ª—É–±–æ–π
    '#FF9F45', // –Ø—Ä–∫–∏–π –û—Ä–∞–Ω–∂–µ–≤—ã–π
    '#A6D96A', // –¢—Ä–∞–≤—è–Ω–æ–π –ó–µ–ª–µ–Ω—ã–π
    '#4ECDC4', // –ë–∏—Ä—é–∑–æ–≤—ã–π
    '#F7CAC9', // –ë–ª–µ–¥–Ω–æ-–†–æ–∑–æ–≤—ã–π
    '#F0EAD6', // –°–≤–µ—Ç–ª—ã–π –ö—Ä–µ–º–æ–≤—ã–π
    '#C7C7C7', // –ß—É—Ç—å –±–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π –°–≤–µ—Ç–ª–æ-–°–µ—Ä—ã–π
    '#FF6B6B', // –ö–æ—Ä–∞–ª–ª–æ–≤–æ-–ö—Ä–∞—Å–Ω—ã–π
    '#DAA520'  // –ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π
];

// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏ (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ sessionStorage)
let playerColorsMap = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
async function initializePlayerColors() {
    try {
        if (!currentLobbyId) {
            console.log('–ù–µ—Ç currentLobbyId –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ü–≤–µ—Ç–æ–≤');
            return;
        }
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏–∑ –ë–î
        const { data: lobbyData, error: lobbyError } = await supabase
            .from('lobbies')
            .select('player_colors')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (lobbyError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –∏–∑ –ë–î:', lobbyError);
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        } else if (lobbyData && lobbyData.player_colors) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ –ë–î
            playerColorsMap = lobbyData.player_colors;
            // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
            const savedColorsKey = `playerColors_${currentLobbyId}`;
            sessionStorage.setItem(savedColorsKey, JSON.stringify(playerColorsMap));
            console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏–∑ –ë–î:', playerColorsMap);
            return;
        }
        
        // –ï—Å–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ—Ç –≤ –ë–î, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        const { data: players, error: playersError } = await supabase
            .from('users')
            .select('id, name, email')
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (playersError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤:', playersError);
            return;
        }
        
        if (!players || players.length === 0) {
            console.log('–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤');
            return;
        }
        
        // –°–æ–∑–¥–∞—ë–º –∫–æ–ø–∏—é –º–∞—Å—Å–∏–≤–∞ —Ü–≤–µ—Ç–æ–≤ –∏ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –µ—ë
        const shuffledColors = [...PLAYER_COLORS];
        for (let i = shuffledColors.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledColors[i], shuffledColors[j]] = [shuffledColors[j], shuffledColors[i]];
        }
        
        // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç–∞ –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏
        playerColorsMap = {};
        players.forEach((player, index) => {
            playerColorsMap[player.id] = shuffledColors[index % shuffledColors.length];
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –ë–î
        const { error: updateError } = await supabase
            .from('lobbies')
            .update({ player_colors: playerColorsMap })
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (updateError) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –≤ –ë–î:', updateError);
            // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage
            if (updateError.code === '42703' || updateError.message?.includes('does not exist') || updateError.message?.includes('column')) {
                console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ player_colors –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
            }
        } else {
            console.log('‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î');
        }
        
        // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        const savedColorsKey = `playerColors_${currentLobbyId}`;
        sessionStorage.setItem(savedColorsKey, JSON.stringify(playerColorsMap));
        console.log('‚úÖ –°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤:', playerColorsMap);
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ü–≤–µ—Ç–æ–≤ –∏–≥—Ä–æ–∫–æ–≤:', err);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
async function updatePlayerColorsForNewPlayer(newPlayerId) {
    try {
        if (!currentLobbyId) {
            return;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ –ë–î
        const { data: lobbyData, error: lobbyError } = await supabase
            .from('lobbies')
            .select('player_colors')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (lobbyError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –∏–∑ –ë–î:', lobbyError);
            return;
        }
        
        // –ï—Å–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ—Ç –≤ –ë–î, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–Ω–æ–≤–æ
        if (!lobbyData || !lobbyData.player_colors) {
            await initializePlayerColors();
            return;
        }
        
        playerColorsMap = lobbyData.player_colors;
        
        // –ï—Å–ª–∏ —É –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —É–∂–µ –µ—Å—Ç—å —Ü–≤–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        if (playerColorsMap[newPlayerId]) {
            return;
        }
        
        // –ù–∞—Ö–æ–¥–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞
        const usedColors = new Set(Object.values(playerColorsMap));
        
        // –ù–∞—Ö–æ–¥–∏–º —Å–≤–æ–±–æ–¥–Ω—ã–π —Ü–≤–µ—Ç
        let availableColor = null;
        for (const color of PLAYER_COLORS) {
            if (!usedColors.has(color)) {
                availableColor = color;
                break;
            }
        }
        
        // –ï—Å–ª–∏ –≤—Å–µ —Ü–≤–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π —Ü–≤–µ—Ç (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏)
        if (!availableColor) {
            availableColor = PLAYER_COLORS[0];
        }
        
        // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º —Ü–≤–µ—Ç –Ω–æ–≤–æ–º—É –∏–≥—Ä–æ–∫—É
        playerColorsMap[newPlayerId] = availableColor;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –ë–î
        const { error: updateError } = await supabase
            .from('lobbies')
            .update({ player_colors: playerColorsMap })
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (updateError) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –≤ –ë–î:', updateError);
            // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage
            if (updateError.code === '42703' || updateError.message?.includes('does not exist') || updateError.message?.includes('column')) {
                console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ player_colors –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
            }
        } else {
            console.log('‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –ë–î');
        }
        
        // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        const savedColorsKey = `playerColors_${currentLobbyId}`;
        sessionStorage.setItem(savedColorsKey, JSON.stringify(playerColorsMap));
        console.log('‚úÖ –¶–≤–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω –Ω–æ–≤–æ–º—É –∏–≥—Ä–æ–∫—É:', newPlayerId, availableColor);
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞:', err);
    }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∏–≥—Ä–æ–∫–∞ –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
function getPlayerColor(playerId) {
    if (!playerId) return '#d0d0d0'; // –¶–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    if (!playerColorsMap) {
        // –ï—Å–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ü–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        return '#d0d0d0';
    }
    
    return playerColorsMap[playerId] || '#d0d0d0';
}

// –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π
const PROFESSIONS = [
    '–í—Ä–∞—á', '–£—á–∏—Ç–µ–ª—å', '–ò–Ω–∂–µ–Ω–µ—Ä', '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç', '–ü–æ–≤–∞—Ä', '–°—Ç—Ä–æ–∏—Ç–µ–ª—å', '–í–æ–¥–∏—Ç–µ–ª—å',
    '–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π', '–ü–æ–∂–∞—Ä–Ω—ã–π', '–Æ—Ä–∏—Å—Ç', '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä', '–ú–µ–Ω–µ–¥–∂–µ—Ä', '–ü—Ä–æ–¥–∞–≤–µ—Ü',
    '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä', '–≠–ª–µ–∫—Ç—Ä–∏–∫', '–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫', '–•—É–¥–æ–∂–Ω–∏–∫', '–ú—É–∑—ã–∫–∞–Ω—Ç', '–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç',
    '–§–æ—Ç–æ–≥—Ä–∞—Ñ', '–î–∏–∑–∞–π–Ω–µ—Ä', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä', '–ü–∏–ª–æ—Ç', '–°—Ç—é–∞—Ä–¥–µ—Å—Å–∞', '–ú–æ—Ä—è–∫',
    '–§–µ—Ä–º–µ—Ä', '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä', '–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥', '–§–∞—Ä–º–∞—Ü–µ–≤—Ç', '–ú–µ–¥—Å–µ—Å—Ç—Ä–∞', '–ü—Å–∏—Ö–æ–ª–æ–≥',
    '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫', '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å', '–ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å', '–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫', '–≠–∫–æ–Ω–æ–º–∏—Å—Ç',
    '–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥', 'HR-–º–µ–Ω–µ–¥–∂–µ—Ä', '–õ–æ–≥–∏—Å—Ç', '–û—Ö—Ä–∞–Ω–Ω–∏–∫', '–ö—É—Ä—å–µ—Ä', '–£–±–æ—Ä—â–∏–∫',
    '–°–≤–∞—Ä—â–∏–∫', '–¢–æ–∫–∞—Ä—å', '–°–ª–µ—Å–∞—Ä—å', '–ú–∞–ª—è—Ä', '–ü–ª–æ—Ç–Ω–∏–∫', '–°—Ç–æ–ª—è—Ä'
];

// –°–ø–∏—Å–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∑–¥–æ—Ä–æ–≤—å—è
const HEALTH_CONDITIONS = [
    '–ò–î–ï–ê–õ–¨–ù–û –ó–î–û–†–û–í',
    '–•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ',
    '–ê–ª–ª–µ—Ä–≥–∏—è',
    '–°–ª–∞–±–æ–µ –∑—Ä–µ–Ω–∏–µ',
    '–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–¥—Ü–µ–º',
    '–î–∏–∞–±–µ—Ç',
    '–ê—Å—Ç–º–∞',
    '–ê—Ä—Ç—Ä–∏—Ç',
    '–ì–∏–ø–µ—Ä—Ç–æ–Ω–∏—è',
    '–ú–∏–≥—Ä–µ–Ω—å',
    '–ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞',
    '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ–º',
    '–û—Å—Ç–µ–æ—Ö–æ–Ω–¥—Ä–æ–∑',
    '–í–∞—Ä–∏–∫–æ–∑',
    '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—á–∫–∞–º–∏',
    '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—á–µ–Ω—å—é',
    '–°–∫–æ–ª–∏–æ–∑',
    '–ü–ª–æ—Å–∫–æ—Å—Ç–æ–ø–∏–µ',
    '–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–ª—É—Ö–æ–º',
    '–ß–∞—Å—Ç—ã–µ –ø—Ä–æ—Å—Ç—É–¥—ã'
];

// –°–ø–∏—Å–æ–∫ —Ö–æ–±–±–∏
const HOBBIES = [
    '–°—Ç—Ä–µ–ª—å–±–∞ –∏–∑ –ª—É–∫–∞',
    '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è',
    '–ì—Ä–∏–±—ã –∏ –≥–æ–º–µ–æ–ø–∞—Ç–∏—è',
    '–ô–æ–≥–∞',
    '–ö—É–ª–∏–Ω–∞—Ä–∏—è',
    '–†–∞–¥–∏–æ–ª—é–±–∏—Ç–µ–ª—å—Å—Ç–≤–æ',
    '–ü—á–µ–ª–æ–≤–æ–¥—Å—Ç–≤–æ',
    '–í—ã—à–∏–≤–∞–Ω–∏–µ',
    '–†–µ–∑—å–±–∞ –ø–æ –¥–µ—Ä–µ–≤—É',
    '–ú–∞—Å—Å–∞–∂',
    '–°–∫–æ—Ä–æ—á—Ç–µ–Ω–∏–µ',
    '–ñ–æ–Ω–≥–ª–∏—Ä–æ–≤–∞–Ω–∏–µ',
    '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏—è',
    '–ú—ã–ª–æ–≤–∞—Ä–µ–Ω–∏–µ',
    '–ì–∏–ø–Ω–æ–∑',
    '–î–∞–π–≤–∏–Ω–≥',
    '–°–∞–º–æ–≥–æ–Ω–æ–≤–∞—Ä–µ–Ω–∏–µ',
    '–ê–ª—å–ø–∏–Ω–∏–∑–º',
    '–§–∏—Ç–Ω–µ—Å',
    '–ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—è',
    '–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ',
    '–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è',
    '–û—Ä–∏–≥–∞–º–∏',
    '–ì–æ–Ω—á–∞—Ä—Å—Ç–≤–æ',
    '–î—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞',
    '–°–±–æ—Ä –≥—Ä–∏–±–æ–≤',
    '–ú–æ—Ä–∂–µ–≤–∞–Ω–∏–µ',
    '–¢–∞—Ç—É–∏—Ä–æ–≤—â–∏–∫',
    '–°–≤–µ—á–∏–π–Ω–æ–µ –¥–µ–ª–æ',
    '–ë–æ–∫—Å',
    '–ü–µ–Ω–∏–µ',
    '–ü–∞—Ä–∫—É—Ä',
    '–¢—Ä–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ',
    '–ó–≤—ë–∑–¥–Ω—ã–µ –∫–∞—Ä—Ç—ã',
    '–ö–∞—Ç–æ–ª–∏—á–µ—Å—Ç–≤–æ',
    '–®–∞—Ö–º–∞—Ç—ã',
    '–¢–∞–Ω—Ü—ã',
    '–ö–∞–ª–ª–∏–≥—Ä–∞—Ñ–∏—è',
    '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è',
    '–ì–∏—Ç–∞—Ä–∞',
    '–¢–∞–π—Å–∫–∏–π –±–æ–∫—Å',
    '–ì–æ—Ä–æ—Å–∫–æ–ø—ã',
    '–ü–µ–π–Ω—Ç–±–æ–ª',
    '–ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç—Å–º–µ–Ω',
    '–ë—ã–ª –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º –ø–æ –≤—ã–∂–∏–≤–∞–Ω–∏—é'
];

// –°–ø–∏—Å–æ–∫ —Ñ–æ–±–∏–π
const PHOBIAS = [
    '–ö–ª–∞—É—Å—Ç—Ä–æ—Ñ–æ–±–∏—è',
    '–ù–æ–∫—Ç–æ—Ñ–æ–±–∏—è',
    '–ê—Ä–∞—Ö–Ω–æ—Ñ–æ–±–∏—è',
    '–ì–∏–¥—Ä–æ—Ñ–æ–±–∏—è',
    '–ê—ç—Ä–æ—Ñ–æ–±–∏—è',
    '–ì–µ–º–æ—Ñ–æ–±–∏—è',
    '–≠–º–º–µ—Ç—Ä–æ—Ñ–æ–±–∏—è',
    '–¢—Ä–∏–ø–∞–Ω–æ—Ñ–æ–±–∏—è',
    '–ú–∏–∫–æ—Ñ–æ–±–∏—è',
    '–ê–∫—É—Ñ–æ–±–∏—è',
    '–ü–∞—Ç—Ñ–æ–±–∏—è',
    '–ê–ø–æ—Ñ–æ–±–∏—è',
    '–ì–∏–ø—Å–æ—Ñ–æ–±–∏—è',
    '–ù–µ–∫—Ä–æ—Ñ–æ–±–∏—è',
    '–ó–æ–æ—Ñ–æ–±–∏—è',
    '–ü–∏—Ä—Ä–æ—Ñ–æ–±–∏—è',
    '–¢–∞—Ñ–µ—Ñ–æ–±–∏—è',
    '–ê–ª–∏—É—Ä—Ñ–æ–±–∏—è',
    '–ì–µ—Ä–º–æ—Ñ–æ–±–∏—è',
    '–§–æ–±–æ—Ñ–æ–±–∏—è',
    '–ê–Ω—Ç—Ä–æ–ø–æ—Ñ–æ–±–∏—è',
    '–î–µ–º–æ—Ñ–æ–±–∏—è',
    '–ö–∏–±–µ—Ä—Ñ–æ–±–∏—è',
    '–†–∞–¥–∏–æ—Ñ–æ–±–∏—è',
    '–¢–æ–∫—Å–∏—Ñ–æ–±–∏—è',
    '–û–∫–µ–∞–Ω–æ—Ñ–æ–±–∏—è',
    '–°—Ü–∏–æ–º–æ—Ñ–æ–±–∏—è',
    '–ë–∞—Ç—Ä–∞—Ö–æ—Ñ–æ–±–∏—è',
    '–°–æ–º–Ω–∏—Ñ–æ–±–∏—è',
    '–≠—Ä–≥–æ—Ñ–æ–±–∏—è',
    '–§–æ–Ω–æ—Ñ–æ–±–∏—è',
    '–¢–µ—Ö–Ω–æ—Ñ–æ–±–∏—è',
    '–ö—Ä–∏–æ—Ñ–æ–±–∏—è',
    '–ù–æ–º–æ—Ñ–æ–±–∏—è',
    '–ê—É—Ç–æ—Ñ–æ–±–∏—è',
    '–ì–∞–ø—Ç–æ—Ñ–æ–±–∏—è',
    '–ù–æ–∑–æ–∫–æ–º–µ—Ñ–æ–±–∏—è',
    '–ê–∫–≤–∞—Ñ–æ–±–∏—è',
    '–ì–ª–µ–Ω–æ—Ñ–æ–±–∏—è',
    '–õ–∏–ª–æ—Ñ–æ–±–∏—è',
    '–ö–æ–ø–æ—Ñ–æ–±–∏—è',
    '–ê–±–ª—é—Ç–æ—Ñ–æ–±–∏—è',
    '–ö–∞—Ç–∞–≥–µ–ª—å–æ—Ñ–æ–±–∏—è',
    '–ü–µ–¥–æ—Ñ–æ–±–∏—è',
    '–ì–∏–ø–µ–Ω–≥–∏–æ—Ñ–æ–±–∏—è',
    '–ö–æ—É–ª—Ä–æ—Ñ–æ–±–∏—è',
    '–¢—Ä–∏—Å–∫–∞–π–¥–µ–∫–∞—Ñ–æ–±–∏—è',
    '–ö—Å–µ–Ω–æ—Ñ–æ–±–∏—è',
    '–ù–µ—Ç —Ñ–æ–±–∏–π'
];

// –°–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç–æ–≤
const FACTS = [
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã —Å–∞–º–æ–æ–±–æ—Ä–æ–Ω—ã',
    '–†–∞–±–æ—Ç–∞–ª –ø–æ–≤–∞—Ä–æ–º –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏',
    '–†–∞–±–æ—Ç–∞–ª –æ—Ö—Ä–∞–Ω–Ω–∏–∫–æ–º –≤ –±–∞–Ω–∫–µ',
    '–ü–µ—Ä–µ–∂–∏–ª –∫–æ—Ä–∞–±–ª–µ–∫—Ä—É—à–µ–Ω–∏–µ',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ –ª–µ—Å—É',
    '–†–∞–±–æ—Ç–∞–ª –º–µ—Ö–∞–Ω–∏–∫–æ–º –Ω–∞ –∑–∞–≤–æ–¥–µ',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è',
    '–†–∞–±–æ—Ç–∞–ª —Å–ø–∞—Å–∞—Ç–µ–ª–µ–º –Ω–∞ –≤–æ–¥–µ',
    '–ü–µ—Ä–µ–∂–∏–ª –æ–≥—Ä–∞–±–ª–µ–Ω–∏–µ',
    '–†–∞–±–æ—Ç–∞–ª –±–∞—Ä–º–µ–Ω–æ–º –≤ –∫–ª—É–±–µ',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã —ç–ª–µ–∫—Ç—Ä–∏–∫–∞',
    '–†–∞–±–æ—Ç–∞–ª –≥–∏–¥–æ–º –≤ –≥–æ—Ä–∞—Ö',
    '–ü–µ—Ä–µ–∂–∏–ª –∞–≤—Ç–æ–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –∞–≥—Ä–æ–Ω–æ–º–∞',
    '–†–∞–±–æ—Ç–∞–ª –∂—É—Ä–Ω–∞–ª–∏—Å—Ç–æ–º',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä–∞',
    '–†–∞–±–æ—Ç–∞–ª –≤–æ–¥–∏—Ç–µ–ª–µ–º –≥—Ä—É–∑–æ–≤–∏–∫–∞',
    '–ü–µ—Ä–µ–∂–∏–ª —É—Ä–∞–≥–∞–Ω',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞',
    '–†–∞–±–æ—Ç–∞–ª –∞–∫—Ç—ë—Ä–æ–º –≤ —Ç–µ–∞—Ç—Ä–µ',
    '–†–∞–±–æ—Ç–∞–ª —Ñ–µ—Ä–º–µ—Ä–æ–º',
    '–ü–µ—Ä–µ–∂–∏–ª –ª–µ—Å–Ω–æ–π –ø–æ–∂–∞—Ä',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –º–µ–¥–±—Ä–∞—Ç–∞',
    '–†–∞–±–æ—Ç–∞–ª —Å—Ç—Ä–æ–∏—Ç–µ–ª–µ–º',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –ø–∏–ª–æ—Ç–∞',
    '–†–∞–±–æ—Ç–∞–ª —É—á–∏—Ç–µ–ª–µ–º',
    '–ü–µ—Ä–µ–∂–∏–ª —ç–ø–∏–¥–µ–º–∏—é',
    '–†–∞–±–æ—Ç–∞–ª –º—É–∑—ã–∫–∞–Ω—Ç–æ–º',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –¥–∞–π–≤–µ—Ä–∞',
    '–†–∞–±–æ—Ç–∞–ª –ø—Ä–æ–¥–∞–≤—Ü–æ–º',
    '–ü–µ—Ä–µ–∂–∏–ª –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ',
    '–†–∞–±–æ—Ç–∞–ª –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–æ–º',
    '–ü–µ—Ä–µ–∂–∏–ª –≤–∑—Ä—ã–≤',
    '–†–∞–±–æ—Ç–∞–ª –¥–∏–∑–∞–π–Ω–µ—Ä–æ–º',
    '–ü–µ—Ä–µ–∂–∏–ª –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã —Å–∞–º–æ–≥–æ–Ω—â–∏–∫–∞',
    '–†–∞–±–æ—Ç–∞–ª –≥–µ–æ–ª–æ–≥–æ–º',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –∫—É—Ä—Å—ã –∞–ª—å–ø–∏–Ω–∏—Å—Ç–∞',
    '–†–∞–±–æ—Ç–∞–ª —Ñ–∞—Ä–º–∞—Ü–µ–≤—Ç–æ–º',
    '–ü—Ä–æ—Ö–æ–¥–∏–ª –æ–±—É—á–µ–Ω–∏–µ –≤ Counter Strike'
];

// –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–µ–π—Å—Ç–≤–∏–π
const ACTION_CARDS = [
    '–ò–º–º—É–Ω–∏—Ç–µ—Ç –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é: –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —Ä–∞—É–Ω–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ç–∏–≤ —Å–µ–±—è.',
    '–°–º–µ–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏: –í—ã–±—Ä–æ—Å—å—Ç–µ —Å–≤–æ—é –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –∏ –≤–æ–∑—å–º–∏—Ç–µ –Ω–æ–≤—É—é –∏–∑ –∫–æ–ª–æ–¥—ã.',
    '–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–≥–∞–∂–∞: –ü–æ–º–µ–Ω—è–π—Ç–µ—Å—å –±–∞–≥–∞–∂–æ–º —Å –ª—é–±—ã–º –∏–≥—Ä–æ–∫–æ–º.',
    '–ü—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ –∫ —Ä–∞—Å–∫—Ä—ã—Ç–∏—é: –ó–∞—Å—Ç–∞–≤—å—Ç–µ —Ü–µ–ª—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–∫—Ç –¥–æ—Å—Ä–æ—á–Ω–æ.',
    '–£–¥–≤–æ–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤: –í —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ –≤–∞—à–∏ –≥–æ–ª–æ—Å–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞ –¥–≤–∞.',
    '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –≤ –±—É–Ω–∫–µ—Ä–µ: +1 —Å–ª–æ—Ç –¥–ª—è –≤—Å–µ—Ö (–Ω–∞ —Ä–∞—É–Ω–¥).',
    '–ó–∞—Å—Ç–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ –≤–∞—Å –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ–±–∏—é.',
    '–£–ª—É—á—à–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ –ª—é–±–æ–≥–æ (–≤–∫–ª—é—á–∞—è —Å–µ–±—è).',
    '–í—Å–µ –≥–æ–ª–æ—Å—É—é—Ç –∑–∞–Ω–æ–≤–æ, –Ω–æ –Ω–µ–ª—å–∑—è –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –≤ —Ç–µ—Ö, –≤ –∫–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ —Ä–∞–Ω–µ–µ.',
    '–ú–æ–∂–µ—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∫–∞—Ä—Ç—É —Ñ–æ–±–∏–π, –Ω–∞ –Ω–æ–≤—É—é –∏–∑ –∫–æ–ª–æ–¥—ã(—Ç–æ–ª—å–∫–æ —Å–µ–±–µ).',
    '+1 –≥–æ–ª–æ—Å –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏(–≤ –ª—é–±–æ–≥–æ).',
    '–í–µ—Ä–Ω–∏—Ç–µ –∏–∑–≥–Ω–∞–Ω–Ω–æ–≥–æ –≤ –∏–≥—Ä—É –Ω–∞ —Ä–∞—É–Ω–¥.',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ –∫–∞—Ä—Ç—É –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã, –Ω–∞ –Ω–æ–≤—É—é(–≤–∫–ª—é—á–∞—è –≤—Å–µ –∫–æ–º–Ω–∞—Ç—ã/—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –±—É–Ω–∫–µ—Ä–∞).',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ —Å–≤–æ—é –∫–∞—Ä—Ç—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è –Ω–∞ –Ω–æ–≤—É—é –∏–∑ –∫–æ–ª–æ–¥—ã',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ –ª—é–±–æ–º—É –∫–∞—Ä—Ç—É –∑–¥–æ—Ä–æ–≤—å—è –Ω–∞ –Ω–æ–≤—É—é –∏–∑ –∫–æ–ª–æ–¥—ã(–∫—Ä–æ–º–µ —Å–µ–±—è)',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ –∫–∞—Ä—Ç—É —Ñ–æ–±–∏–π –ª—é–±–æ–º—É(–∫—Ä–æ–º–µ —Å–µ–±—è)',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ –∫–∞—Ä—Ç—É —Ö–æ–±–±–∏ –∏–≥—Ä–æ–∫–∞–º –Ω–∞ —á—ë—Ç–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö',
    '–£–∫—Ä–∞–¥–∏—Ç–µ –±–∞–≥–∞–∂ —É –ª—é–±–æ–≥–æ –∏–≥—Ä–æ–∫–∞',
    '–£–≥—Ä–æ–∑–∞, —Ä—è–¥–æ–º —Å –±—É–Ω–∫–µ—Ä–æ–º –≤—Ä–∞–∂–¥–µ–±–Ω—ã–π –æ—Ç—Ä—è–¥ –≤—ã–∂–∏–≤—à–∏—Ö',
    '–£–≥—Ä–æ–∑–∞, —á–µ—Ä–µ–∑ 10 –ª–µ—Ç –≤ –º–µ—Å—Ç–æ –≥–¥–µ –±—É–Ω–∫–µ—Ä, —É–¥–∞—Ä–∏—Ç –º–µ—Ç–µ–æ—Ä–∏—Ç',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ –∫–∞—Ä—Ç—É –ø–æ–ª –∏ –≤–æ–∑—Ä–∞—Å—Ç, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –º–µ–Ω—è–µ—Ç—Å—è –∏ –∑–¥–æ—Ä–æ–≤—å–µ',
    '–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –≤—ã –≥—Ä–æ–º–∫–æ —Ä—ã–≥–Ω—ë—Ç–µ, –≤–µ–¥—É—â–∏–π –ø–æ–º–µ–Ω—è–µ—Ç –∫–∞—Ä—Ç—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–π(—Ç–æ–ª—å–∫–æ –≤–∞–º)',
    '-2 –≥–æ–ª–æ—Å–∞ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏(—Ç–æ–ª—å–∫–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö)',
    '–ï—Å–ª–∏ –≤–∞—Å –∫–∏–∫–∞—é—Ç –∏–∑ –±—É–Ω–∫–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ',
    '–í–æ–¥–∏—Ç–µ–ª—å —Ç–∞–∫—Å–∏ –ø–æ—Å–µ—Ç–∏–ª –≤–∞—Å –≤ –±—É–Ω–∫–µ—Ä–µ, –∏ –æ—Ç–¥–∞–ª –≤–∞–º —Å–≤–æ–π –±–∞–≥–∞–∂(+1 –ø—Ä–µ–¥–º–µ—Ç)',
    '–ü–æ–º–µ–Ω—è–π—Ç–µ—Å—å –∑–¥–æ—Ä–æ–≤—å–µ–º —Å –∏–≥—Ä–æ–∫–æ–º —Å–ø—Ä–∞–≤–∞/—Å–ª–µ–≤–∞ –æ—Ç –≤–∞—Å',
    '–û—Ç–Ω–∏–º–∞–µ—Ç –º–∞–º—É —É –≤–µ–¥—É—â–µ–≥–æ, –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–∞–º –≤ –±–∞–≥–∞–∂(–õ—é–¥–º–∏–ª–∞ 46 –ª–µ—Ç(–ñ–µ–Ω—â–∏–Ω–∞))'
];

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∏–≥—Ä–æ–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ ID
function generatePlayerCardData(playerId) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –∏–≥—Ä–æ–∫–∞ –∫–∞–∫ seed –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    const seed = playerId.toString().split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
    
    // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Å–µ–≤–¥–æ—Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ seed
    function seededRandom(seed, index) {
        const x = Math.sin((seed + index) * 12.9898) * 43758.5453;
        return x - Math.floor(x);
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–∞ –∏ –≤–æ–∑—Ä–∞—Å—Ç–∞: "–ú—É–∂—á–∏–Ω–∞: X –ª–µ—Ç" –∏–ª–∏ "–ñ–µ–Ω—â–∏–Ω–∞: X –ª–µ—Ç", –≥–¥–µ X –æ—Ç 18 –¥–æ 87
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–æ–≤ –∏–∑ –ª–æ–±–±–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è seed –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã—Ö–æ–¥–µ
    const exitCount = parseInt(sessionStorage.getItem(`exitCount_${playerId}`) || '0');
    const seedWithExit = seed + exitCount * 1000; // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–æ–≤ –∫ seed
    
    const genderRandom = seededRandom(seedWithExit, 1);
    const gender = genderRandom < 0.5 ? '–ú—É–∂—á–∏–Ω–∞' : '–ñ–µ–Ω—â–∏–Ω–∞';
    const age = Math.floor(seededRandom(seedWithExit, 1.5) * (87 - 18 + 1)) + 18; // –û—Ç 18 –¥–æ 87 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
    const genderAge = `${gender}: ${age} –ª–µ—Ç`;
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏: "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è: X(Z –ª–µ—Ç)", –≥–¥–µ X - —Å–ª—É—á–∞–π–Ω–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è, Z - —Å—Ç–∞–∂
    const professionIndex = Math.floor(seededRandom(seedWithExit, 2) * PROFESSIONS.length);
    const professionName = PROFESSIONS[professionIndex];
    
    // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞–∂–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã: 18 –ª–µ—Ç
    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑–º–æ–∂–Ω—ã–π —Å—Ç–∞–∂: –≤–æ–∑—Ä–∞—Å—Ç - 18
    // –ù–æ –¥–µ–ª–∞–µ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º: –¥–ª—è –º–æ–ª–æ–¥—ã—Ö (18-25) —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ (–≤–æ–∑—Ä–∞—Å—Ç - 18)
    // –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö (26-40) —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ min(–≤–æ–∑—Ä–∞—Å—Ç - 18, 20)
    // –î–ª—è —Å—Ç–∞—Ä—à–∏—Ö (41+) —Å—Ç–∞–∂ –æ—Ç 3 –¥–æ min(–≤–æ–∑—Ä–∞—Å—Ç - 18, 35)
    const maxPossibleExperience = age - 18;
    let minExperience, maxExperience;
    
    if (age <= 25) {
        // –ú–æ–ª–æ–¥—ã–µ: —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ (–≤–æ–∑—Ä–∞—Å—Ç - 18)
        minExperience = 1;
        maxExperience = Math.max(1, maxPossibleExperience);
    } else if (age <= 40) {
        // –°—Ä–µ–¥–Ω–∏–µ: —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ min(–≤–æ–∑—Ä–∞—Å—Ç - 18, 20)
        minExperience = 1;
        maxExperience = Math.min(maxPossibleExperience, 20);
    } else {
        // –°—Ç–∞—Ä—à–∏–µ: —Å—Ç–∞–∂ –æ—Ç 3 –¥–æ min(–≤–æ–∑—Ä–∞—Å—Ç - 18, 35)
        minExperience = 3;
        maxExperience = Math.min(maxPossibleExperience, 35);
    }
    
    const experience = Math.floor(seededRandom(seedWithExit, 2.5) * (maxExperience - minExperience + 1)) + minExperience;
    const profession = `${professionName} (${experience} –ª–µ—Ç)`;
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è: "–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è: X(Z%)"
    // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–ø–∞–¥–µ–Ω–∏—è "–ò–î–ï–ê–õ–¨–ù–û –ó–î–û–†–û–í" - 50%
    const healthRandom = seededRandom(seedWithExit, 3);
    let healthCondition;
    if (healthRandom < 0.5) {
        // 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å - "–ò–î–ï–ê–õ–¨–ù–û –ó–î–û–†–û–í"
        healthCondition = '–ò–î–ï–ê–õ–¨–ù–û –ó–î–û–†–û–í';
    } else {
        // 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å - —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ (–∫—Ä–æ–º–µ "–ò–î–ï–ê–õ–¨–ù–û –ó–î–û–†–û–í")
        const otherConditions = HEALTH_CONDITIONS.filter(c => c !== '–ò–î–ï–ê–õ–¨–ù–û –ó–î–û–†–û–í');
        const conditionIndex = Math.floor(seededRandom(seedWithExit, 3.1) * otherConditions.length);
        healthCondition = otherConditions[conditionIndex];
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–∞: –æ—Ç 10% –¥–æ 100% —Å —à–∞–≥–æ–º 10 (10, 20, 30, 40, 50, 60, 70, 80, 90, 100)
    const healthPercent = Math.floor(seededRandom(seedWithExit, 3.2) * 10) * 10 + 10; // –û—Ç 10 –¥–æ 100 —Å —à–∞–≥–æ–º 10
    const health = `${healthCondition} (${healthPercent}%)`;
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–æ–±–±–∏: "–•–æ–±–±–∏: X(Y –ª–µ—Ç)", –≥–¥–µ X - —Å–ª—É—á–∞–π–Ω–æ–µ —Ö–æ–±–±–∏ –∏–∑ —Å–ø–∏—Å–∫–∞, Y - —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ 20 –ª–µ—Ç
    const hobbyIndex = Math.floor(seededRandom(seedWithExit, 4) * HOBBIES.length);
    const hobbyName = HOBBIES[hobbyIndex];
    
    // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞–∂–∞ —Ö–æ–±–±–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞
    // –°—Ç–∞–∂ –æ—Ç 1 –¥–æ 20 –ª–µ—Ç, –Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞
    // –î–ª—è –º–æ–ª–æ–¥—ã—Ö (18-25) —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ 5 –ª–µ—Ç
    // –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö (26-40) —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ 10 –ª–µ—Ç
    // –î–ª—è —Å—Ç–∞—Ä—à–∏—Ö (41+) —Å—Ç–∞–∂ –æ—Ç 1 –¥–æ 20 –ª–µ—Ç
    let maxHobbyExperience;
    if (age <= 25) {
        maxHobbyExperience = 5;
    } else if (age <= 40) {
        maxHobbyExperience = 10;
    } else {
        maxHobbyExperience = 20;
    }
    
    const minHobbyExperience = 1;
    const hobbyExperience = Math.floor(seededRandom(seedWithExit, 4.5) * (maxHobbyExperience - minHobbyExperience + 1)) + minHobbyExperience;
    const hobby = `${hobbyName} (${hobbyExperience} –ª–µ—Ç)`;
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ–±–∏–∏: "–§–æ–±–∏—è: X", –≥–¥–µ X - —Å–ª—É—á–∞–π–Ω–∞—è —Ñ–æ–±–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞
    // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–ø–∞–¥–µ–Ω–∏—è "–ù–µ—Ç —Ñ–æ–±–∏–π" - 50%
    const phobiaRandom = seededRandom(seedWithExit, 5);
    let phobia;
    if (phobiaRandom < 0.5) {
        // 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å - "–ù–µ—Ç —Ñ–æ–±–∏–π"
        phobia = '–ù–µ—Ç —Ñ–æ–±–∏–π';
    } else {
        // 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å - —Å–ª—É—á–∞–π–Ω–∞—è —Ñ–æ–±–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞ (–∫—Ä–æ–º–µ "–ù–µ—Ç —Ñ–æ–±–∏–π")
        const otherPhobias = PHOBIAS.filter(p => p !== '–ù–µ—Ç —Ñ–æ–±–∏–π');
        const phobiaIndex = Math.floor(seededRandom(seedWithExit, 5.1) * otherPhobias.length);
        phobia = otherPhobias[phobiaIndex];
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–∫—Ç–æ–≤: "–§–∞–∫—Ç ‚Ññ1: X" –∏ "–§–∞–∫—Ç ‚Ññ2: Y", –≥–¥–µ X –∏ Y - —Ä–∞–∑–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ —Å–ø–∏—Å–∫–∞
    const fact1Index = Math.floor(seededRandom(seedWithExit, 6) * FACTS.length);
    const fact1 = FACTS[fact1Index];
    
    // –î–ª—è fact2 –≤—ã–±–∏—Ä–∞–µ–º —Ñ–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å fact1
    const remainingFacts = FACTS.filter((_, index) => index !== fact1Index);
    const fact2Index = Math.floor(seededRandom(seedWithExit, 7) * remainingFacts.length);
    const fact2 = remainingFacts[fact2Index];
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–µ–π—Å—Ç–≤–∏–π: "–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚Ññ1: X" –∏ "–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚Ññ2: Y", –≥–¥–µ X –∏ Y - —Ä–∞–∑–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞
    const action1Index = Math.floor(seededRandom(seedWithExit, 8) * ACTION_CARDS.length);
    const action1 = ACTION_CARDS[action1Index];
    
    // –î–ª—è action2 –≤—ã–±–∏—Ä–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å action1
    const remainingActions = ACTION_CARDS.filter((_, index) => index !== action1Index);
    const action2Index = Math.floor(seededRandom(seedWithExit, 9) * remainingActions.length);
    const action2 = remainingActions[action2Index];
    
    return {
        genderAge: genderAge,
        profession: profession,
        health: health,
        hobby: hobby,
        phobia: phobia,
        fact1: fact1,
        fact2: fact2,
        action1: action1,
        action2: action2
    };
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∏–≥—Ä–æ–∫–∞—Ö
async function loadPlayersInfo() {
    const currentPlayerNameEl = document.getElementById('currentPlayerName');
    const currentPlayerCardEl = document.getElementById('currentPlayerCard');
    const playersContent = document.getElementById('playersContent');
    
    if (!currentPlayerNameEl || !currentPlayerCardEl || !playersContent) return;
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–Ω–∞—á–∞–ª–∞ –≤ localStorage, –ø–æ—Ç–æ–º –≤ sessionStorage
    let userStr = localStorage.getItem('currentUser');
    if (!userStr) {
        userStr = sessionStorage.getItem('currentUser');
    }
        if (!userStr) return;
        
        const currentUser = JSON.parse(userStr);
        const currentUserName = currentUser.name || currentUser.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
        
        // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        const currentPlayerColor = getPlayerColor(currentUserId);
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–∏–∫ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —à–∞–ø–∫–µ —Å —Ü–≤–µ—Ç–æ–º
        currentPlayerNameEl.textContent = currentUserName;
        currentPlayerNameEl.style.color = currentPlayerColor;
        
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        const { data: players, error: playersError } = await supabase
            .from('users')
            .select('id, name, email')
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (playersError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:', playersError);
            currentPlayerCardEl.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤</p>';
            return;
        }
        
        if (!players || players.length === 0) {
            currentPlayerCardEl.innerHTML = '<p>–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏</p>';
            return;
        }
        
        // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        const currentPlayer = players.find(p => p.id === currentUserId);
        const otherPlayers = players.filter(p => p.id !== currentUserId);
        
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        if (currentPlayer) {
            const currentPlayerData = generatePlayerCardData(currentPlayer.id);
            // –í –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å blur –≤–æ–æ–±—â–µ
            currentPlayerCardEl.innerHTML = `
                <div class="player-card-info">
                    <div class="player-info-item" data-item="genderAge" data-player-id="${currentPlayer.id}">
                        <strong>–ü–æ–ª –∏ –≤–æ–∑—Ä–∞—Å—Ç:</strong><span>${currentPlayerData.genderAge}</span>
                        <button class="blur-toggle-btn" data-item="genderAge" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="profession" data-player-id="${currentPlayer.id}">
                        <strong>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è:</strong><span>${currentPlayerData.profession}</span>
                        <button class="blur-toggle-btn" data-item="profession" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="health" data-player-id="${currentPlayer.id}">
                        <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è:</strong><span>${currentPlayerData.health}</span>
                        <button class="blur-toggle-btn" data-item="health" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="hobby" data-player-id="${currentPlayer.id}">
                        <strong>–•–æ–±–±–∏:</strong><span>${currentPlayerData.hobby}</span>
                        <button class="blur-toggle-btn" data-item="hobby" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="phobia" data-player-id="${currentPlayer.id}">
                        <strong>–§–æ–±–∏—è:</strong><span>${currentPlayerData.phobia}</span>
                        <button class="blur-toggle-btn" data-item="phobia" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="fact1" data-player-id="${currentPlayer.id}">
                        <strong>–§–∞–∫—Ç ‚Ññ1:</strong><span>${currentPlayerData.fact1}</span>
                        <button class="blur-toggle-btn" data-item="fact1" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="fact2" data-player-id="${currentPlayer.id}">
                        <strong>–§–∞–∫—Ç ‚Ññ2:</strong><span>${currentPlayerData.fact2}</span>
                        <button class="blur-toggle-btn" data-item="fact2" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="action1" data-player-id="${currentPlayer.id}">
                        <strong>–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚Ññ1:</strong><span>${currentPlayerData.action1}</span>
                        <button class="blur-toggle-btn" data-item="action1" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                    <div class="player-info-item" data-item="action2" data-player-id="${currentPlayer.id}">
                        <strong>–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚Ññ2:</strong><span>${currentPlayerData.action2}</span>
                        <button class="blur-toggle-btn" data-item="action2" data-player-id="${currentPlayer.id}" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å blur">üëÅÔ∏è</button>
                    </div>
                </div>
                <button class="current-player-bottom-btn" id="currentPlayerBottomBtn">–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
            `;
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è blur
            setupBlurToggleButtons();
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            setupRefreshButtons();
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            setupVotingButton();
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –∫ –∫–Ω–æ–ø–∫–µ "–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å"
            const votingBtn = document.getElementById('currentPlayerBottomBtn');
            if (votingBtn && currentPlayerColor) {
                votingBtn.style.background = `${currentPlayerColor}20`;
                votingBtn.style.borderColor = currentPlayerColor;
                votingBtn.style.color = currentPlayerColor;
                votingBtn.style.textShadow = `0 0 10px ${currentPlayerColor}80`;
                votingBtn.style.boxShadow = `0 4px 20px ${currentPlayerColor}40`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
                votingBtn.addEventListener('mouseenter', () => {
                    votingBtn.style.background = `${currentPlayerColor}30`;
                    votingBtn.style.borderColor = currentPlayerColor;
                    votingBtn.style.boxShadow = `0 6px 25px ${currentPlayerColor}60`;
                });
                
                votingBtn.addEventListener('mouseleave', () => {
                    votingBtn.style.background = `${currentPlayerColor}20`;
                    votingBtn.style.boxShadow = `0 4px 20px ${currentPlayerColor}40`;
                });
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö blur —É–∂–µ —Å–Ω—è—Ç
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            setTimeout(() => {
                restoreUnblurredData();
            }, 100);
        } else {
            currentPlayerCardEl.innerHTML = '';
        }
        
        // –ö–∞—Ä—Ç–æ—á–∫–∏ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ (–í–ù–ï –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞)
        if (otherPlayers.length === 0) {
            playersContent.innerHTML = '';
        } else {
            const otherPlayersHTML = otherPlayers.map(player => {
                const playerName = player.name || player.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur –¥–ª—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                initializeBlurStates(player.id);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ ID
                const playerData = generatePlayerCardData(player.id);
                
                // –í–ê–ñ–ù–û: data-player-id –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω ID –∏–≥—Ä–æ–∫–∞, —á—å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
                // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                // –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–π—Ç–∏ –∏ –æ–±–Ω–æ–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                // player.id - —ç—Ç–æ ID –∏–≥—Ä–æ–∫–∞, —á—å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
                return `
                    <div class="flip-card player-card-flip" style="min-height: 900px; width: 468px; flex-shrink: 0;" data-player-id="${player.id}">
                        <div class="flip-card-inner">
                            <div class="flip-card-front game-block player-card-block">
                                <div class="game-block-header">
                                    <h2 class="game-block-title">${playerName}</h2>
                                </div>
                                <div class="game-block-content player-card-info">
                                    ${generatePlayerInfoItem('genderAge', '–ü–æ–ª –∏ –≤–æ–∑—Ä–∞—Å—Ç', playerData.genderAge, player.id)}
                                    ${generatePlayerInfoItem('profession', '–ü—Ä–æ—Ñ–µ—Å—Å–∏—è', playerData.profession, player.id)}
                                    ${generatePlayerInfoItem('health', '–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è', playerData.health, player.id)}
                                    ${generatePlayerInfoItem('hobby', '–•–æ–±–±–∏', playerData.hobby, player.id)}
                                    ${generatePlayerInfoItem('phobia', '–§–æ–±–∏—è', playerData.phobia, player.id)}
                                    ${generatePlayerInfoItem('fact1', '–§–∞–∫—Ç ‚Ññ1', playerData.fact1, player.id)}
                                    ${generatePlayerInfoItem('fact2', '–§–∞–∫—Ç ‚Ññ2', playerData.fact2, player.id)}
                                    ${generatePlayerInfoItem('action1', '–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚Ññ1', playerData.action1, player.id)}
                                    ${generatePlayerInfoItem('action2', '–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ‚Ññ2', playerData.action2, player.id)}
                                </div>
                            </div>
                            <div class="flip-card-back">
                                <img src="bunker-logo.png" alt="BUNKER THE BOARD GAME" class="bunker-logo">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            playersContent.innerHTML = `<div class="players-list">${otherPlayersHTML}</div>`;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            setTimeout(async () => {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–∑ –ë–î
                const { data: lobbyData } = await supabase
                    .from('lobbies')
                    .select('cards_locked, bunker_card_data')
                    .eq('lobby_id', parseInt(currentLobbyId))
                    .maybeSingle();
                
                if (lobbyData) {
                    const isLocked = lobbyData?.cards_locked !== false;
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º bunker_card_data)
                    const allFlipCards = document.querySelectorAll('.player-card-flip');
                    allFlipCards.forEach(flipCard => {
                        const flipCardInner = flipCard.querySelector('.flip-card-inner');
                        if (!flipCardInner) return;
                        
                        if (isLocked) {
                            flipCardInner.classList.add('flipped');
                            flipCard.classList.add('cards-locked');
                        } else {
                            flipCardInner.classList.remove('flipped');
                            flipCard.classList.remove('cards-locked');
                        }
                    });
                }
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö blur —É–∂–µ —Å–Ω—è—Ç
                restoreUnblurredData();
            }, 100);
        }
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∏–≥—Ä–æ–∫–∞—Ö:', err);
        currentPlayerCardEl.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>';
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è blur –∏–∑ –ë–î
async function loadBlurStatesFromDB() {
    try {
        if (!currentLobbyId) {
            console.log('–ù–µ—Ç currentLobbyId, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É blur_states');
            return;
        }
        
        try {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –ª–æ–±–±–∏ (–ø–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ lobby_id)
            const { data: lobbyCheck, error: checkError } = await supabase
                .from('lobbies')
                .select('lobby_id')
                .eq('lobby_id', parseInt(currentLobbyId))
                .single();
            
            if (checkError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–±–±–∏:', checkError);
                console.error('   –ö–æ–¥ –æ—à–∏–±–∫–∏:', checkError.code);
                console.error('   –°–æ–æ–±—â–µ–Ω–∏–µ:', checkError.message);
                return;
            }
            
            console.log('‚úÖ –î–æ—Å—Ç—É–ø –∫ –ª–æ–±–±–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, lobby_id:', lobbyCheck.lobby_id);
            
            // –¢–µ–ø–µ—Ä—å –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å blur_states
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º SELECT * —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏
            let lobbyData = null;
            let error = null;
            
            const result = await supabase
                .from('lobbies')
                .select('*')
                .eq('lobby_id', parseInt(currentLobbyId))
                .single();
            
            if (result.error) {
                error = result.error;
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ª–æ–±–±–∏:', error);
                console.error('   –ö–æ–¥ –æ—à–∏–±–∫–∏:', error.code);
                console.error('   –°–æ–æ–±—â–µ–Ω–∏–µ:', error.message);
                console.error('   –î–µ—Ç–∞–ª–∏:', error.details);
                console.error('   –ü–æ–¥—Å–∫–∞–∑–∫–∞:', error.hint);
                
                // –ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ 400 Bad Request, –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å RLS –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–æ–º
                if (error.code === 'PGRST301' || error.message?.includes('permission denied') || error.message?.includes('RLS')) {
                    console.error('‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ (RLS). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Supabase.');
                }
                
                // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                if (error.code === '42703' || 
                    error.code === 'PGRST116' || 
                    error.message?.includes('column') || 
                    error.message?.includes('does not exist') ||
                    error.message?.includes('lobbies.id') ||
                    error.message?.includes('blur_states')) {
                    console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ blur_states –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
                    return;
                }
                return;
            } else {
                lobbyData = result.data;
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ª–æ–±–±–∏ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —á–µ—Ä–µ–∑ SELECT *');
                console.log('   –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏:', Object.keys(lobbyData));
                console.log('   blur_states:', lobbyData.blur_states);
                console.log('   –¢–∏–ø blur_states:', typeof lobbyData.blur_states);
            }
        
        if (lobbyData && lobbyData.blur_states) {
            const blurStates = lobbyData.blur_states;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è blur –≤ sessionStorage
            Object.keys(blurStates).forEach(playerId => {
                const playerBlurStates = blurStates[playerId] || {};
                Object.keys(playerBlurStates).forEach(itemType => {
                    const blurState = playerBlurStates[itemType];
                    const blurKey = `blur_${playerId}_${itemType}`;
                    sessionStorage.setItem(blurKey, blurState);
                });
            });
            
            console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏—è blur –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ë–î');
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ blur
            await loadPlayersInfo();
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö blur —É–∂–µ —Å–Ω—è—Ç
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            setTimeout(() => {
                restoreUnblurredData();
            }, 150);
            }
        } catch (dbError) {
            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ë–î, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage
            console.log('‚ÑπÔ∏è –û—à–∏–±–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage:', dbError.message);
        }
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ blur_states:', err);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
async function loadVoting() {
    const votingContent = document.getElementById('votingContent');
    if (!votingContent) return;
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        const { data: players, error: playersError } = await supabase
            .from('users')
            .select('id, name, email')
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (playersError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', playersError);
            votingContent.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤</p>';
            return;
        }
        
        if (!players || players.length === 0) {
            votingContent.innerHTML = '<p>–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏</p>';
            return;
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ ID –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞
        const sortedPlayers = [...players].sort((a, b) => {
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ ID (–ø—Ä–∏–≤–æ–¥–∏–º –∫ —Å—Ç—Ä–æ–∫–∞–º –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
            const idA = String(a.id).toLowerCase();
            const idB = String(b.id).toLowerCase();
            if (idA < idB) return -1;
            if (idA > idB) return 1;
            return 0;
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –≥–æ–ª–æ—Å–∞ –∏–∑ –ë–î
        const { data: lobbyData, error: votesError } = await supabase
            .from('lobbies')
            .select('votes')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        let allVotes = {};
        if (!votesError && lobbyData && lobbyData.votes) {
            allVotes = lobbyData.votes;
            console.log('üìä –ó–∞–≥—Ä—É–∂–µ–Ω—ã –≥–æ–ª–æ—Å–∞ –∏–∑ –ë–î:', allVotes);
        } else if (votesError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤ –∏–∑ –ë–î:', votesError);
        }
        
        // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Å –µ–≥–æ –≥–æ–ª–æ—Å–∞–º–∏
        const votingHTML = sortedPlayers.map(player => {
            const playerName = player.name || player.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            const playerColor = getPlayerColor(player.id);
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ—Ö, –∫—Ç–æ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª –∑–∞ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º ID –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            const votesForPlayer = Object.entries(allVotes)
                .filter(([voterId, voteData]) => {
                    if (!voteData || !voteData.targetId) {
                        return false;
                    }
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ID –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–ø—Ä–∏–≤–æ–¥–∏–º –∫ —Å—Ç—Ä–æ–∫–∞–º)
                    const targetIdNormalized = String(voteData.targetId).trim();
                    const playerIdNormalized = String(player.id).trim();
                    return targetIdNormalized === playerIdNormalized;
                })
                .map(([voterId, voteData]) => {
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º voterId –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
                    const normalizedVoterId = String(voterId).trim();
                    return {
                        voterId: normalizedVoterId,
                        voterName: voteData.voterName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π',
                        firstLetter: voteData.firstLetter || '‚óè',
                        voterColor: getPlayerColor(normalizedVoterId)
                    };
                });
            
            // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∫—Ä—É–∂–æ—á–∫–æ–≤ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)
            const circlesHTML = votesForPlayer.map(vote => {
                return `<span class="voting-circle" style="color: ${vote.voterColor}; background-color: ${vote.voterColor}20; border: 2px solid ${vote.voterColor};" title="${vote.voterName}">${vote.firstLetter}</span>`;
            }).join('');
            
            return `
                <div class="voting-item">
                    <span class="voting-player-name" style="color: ${playerColor};">${playerName}</span>
                    <div class="voting-circles-container">
                        ${circlesHTML}
                    </div>
                </div>
            `;
        }).join('');
        
        votingContent.innerHTML = `
            <div class="voting-list">
                ${votingHTML}
            </div>
        `;
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', err);
        votingContent.innerHTML = '<p class="game-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</p>';
    }
}



// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è blur
function setupBlurToggleButtons() {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è blur
    document.addEventListener('click', async (e) => {
        const button = e.target.closest('.blur-toggle-btn');
        if (!button) return;
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        
        const itemType = button.getAttribute('data-item');
        const playerId = button.getAttribute('data-player-id');
        
        if (!itemType || !playerId) {
            console.log('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç data-item –∏–ª–∏ data-player-id');
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur
        const blurKey = `blur_${playerId}_${itemType}`;
        const currentState = sessionStorage.getItem(blurKey);
        const newState = (currentState === '1' || currentState === null) ? '0' : '1';
        
        console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ blur:', itemType, '–¥–ª—è –∏–≥—Ä–æ–∫–∞:', playerId);
        console.log('  - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', currentState || '1 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)');
        console.log('  - –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', newState);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ sessionStorage
        sessionStorage.setItem(blurKey, newState);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Supabase –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞)
        await saveBlurState(playerId, itemType, newState);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ blur –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
        updateBlurDisplay(playerId, itemType, newState);
        
        // –ï—Å–ª–∏ blur —Å–Ω—è—Ç (newState === '0'), –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        if (newState === '0') {
            generateAndDisplayData(playerId, itemType);
        }
        
        console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ blur –æ–±–Ω–æ–≤–ª–µ–Ω–æ:', blurKey, '=', newState);
        
        return false; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–ø–ª—ã—Ç–∏—è —Å–æ–±—ã—Ç–∏—è
    }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö blur —É–∂–µ —Å–Ω—è—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
function restoreUnblurredData() {
    console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–Ω—è—Ç—ã–º blur...');
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-player-id (–≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ)
    const allItems = document.querySelectorAll('.player-info-item[data-player-id]');
    const currentPlayerCardEl = document.getElementById('currentPlayerCard');
    
    console.log(`  - –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${allItems.length}`);
    
    if (allItems.length === 0) {
        console.warn('  ‚ö† –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! –í–æ–∑–º–æ–∂–Ω–æ, DOM –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω.');
        return;
    }
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ playerId –∏ itemType, —á—Ç–æ–±—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
    const processed = new Set();
    let restoredCount = 0;
    
    allItems.forEach(item => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ (—Ç–∞–º –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Ä–µ–∞–ª—å–Ω—ã–µ)
        if (currentPlayerCardEl && currentPlayerCardEl.contains(item)) {
            return;
        }
        
        const playerId = item.getAttribute('data-player-id');
        const itemType = item.getAttribute('data-item');
        
        if (!playerId || !itemType) {
            return;
        }
        
        const key = `${playerId}_${itemType}`;
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏
        if (processed.has(key)) {
            return;
        }
        
        processed.add(key);
        
        const blurKey = `blur_${playerId}_${itemType}`;
        let blurState = sessionStorage.getItem(blurKey);
        
        // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–Ω–æ –≤ –¥—Ä—É–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        if (blurState === null) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–ª—é—á–µ–π
            const altKey1 = `blur_${playerId}_${itemType}`;
            const altKey2 = `blur_${itemType}_${playerId}`;
            blurState = sessionStorage.getItem(altKey1) || sessionStorage.getItem(altKey2);
        }
        
        console.log(`  - –ø—Ä–æ–≤–µ—Ä–∫–∞: playerId=${playerId}, itemType=${itemType}, blurState=${blurState || 'null (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–±–ª—é—Ä–µ–Ω–æ)'}, blurKey=${blurKey}`);
        
        // –ï—Å–ª–∏ blur —Å–Ω—è—Ç (—Å–æ—Å—Ç–æ—è–Ω–∏–µ '0'), –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        if (blurState === '0' || blurState === 0) {
            console.log(`  ‚úì –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${itemType} –∏–≥—Ä–æ–∫–∞ ${playerId}`);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            setTimeout(() => {
                generateAndDisplayData(playerId, itemType);
            }, 50 * restoredCount); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            restoredCount++;
        } else {
            console.log(`  - –ø—Ä–æ–ø—É—Å–∫: blurState=${blurState} (–Ω–µ —Ä–∞–≤–Ω–æ '0')`);
        }
    });
    
    console.log(`‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${processed.size} —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${restoredCount}`);
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ blur
function generateAndDisplayData(playerId, itemType) {
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–≥—Ä–æ–∫–∞
    const playerData = generatePlayerCardData(playerId);
    
    // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
    let realValue = '';
    switch(itemType) {
        case 'genderAge':
            realValue = playerData.genderAge;
            break;
        case 'profession':
            realValue = playerData.profession;
            break;
        case 'health':
            realValue = playerData.health;
            break;
        case 'hobby':
            realValue = playerData.hobby;
            break;
        case 'phobia':
            realValue = playerData.phobia;
            break;
        case 'fact1':
            realValue = playerData.fact1;
            break;
        case 'fact2':
            realValue = playerData.fact2;
            break;
        case 'action1':
            realValue = playerData.action1;
            break;
        case 'action2':
            realValue = playerData.action2;
            break;
        default:
            return;
    }
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –¥–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    // –ò—Å–∫–ª—é—á–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    const currentPlayerCardEl = document.getElementById('currentPlayerCard');
    let allItems = document.querySelectorAll(`.player-info-item[data-item="${itemType}"][data-player-id="${playerId}"]`);
    
    if (currentPlayerCardEl) {
        allItems = Array.from(allItems).filter(item => !currentPlayerCardEl.contains(item));
    }
    
    console.log(`  - –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${allItems.length}`);
    
    if (allItems.length === 0) {
        console.warn(`  ‚ö† –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö! playerId=${playerId}, itemType=${itemType}`);
        return;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ span –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
    allItems.forEach((item, index) => {
        console.log(`  [${index + 1}/${allItems.length}] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞:`, item);
        
        // –ò—â–µ–º span —Å data-seed –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ span —Å —Ç–µ–∫—Å—Ç–æ–º (–Ω–µ –∫–Ω–æ–ø–∫—É)
        let span = item.querySelector('span[data-seed]');
        if (!span) {
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å data-seed, –∏—â–µ–º –ª—é–±–æ–π span, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π
            const allSpans = item.querySelectorAll('span');
            console.log(`    - –Ω–∞–π–¥–µ–Ω–æ spans: ${allSpans.length}`);
            for (let s of allSpans) {
                if (!s.classList.contains('blur-toggle-btn') && !s.closest('.blur-toggle-btn')) {
                    span = s;
                    console.log(`    - –≤—ã–±—Ä–∞–Ω span:`, span);
                    break;
                }
            }
        }
        
        if (span) {
            const oldText = span.textContent;
            console.log(`    ‚úì –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${itemType}: "${oldText}" -> "${realValue}"`);
            span.textContent = realValue;
            span.classList.remove('blurred-text');
            // –£–±–∏—Ä–∞–µ–º blur —á–µ—Ä–µ–∑ inline —Å—Ç–∏–ª—å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            span.style.setProperty('filter', 'none', 'important');
            // –£–±–∏—Ä–∞–µ–º placeholder, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
            if (span.textContent === '***') {
                span.textContent = realValue;
            }
            console.log(`    ‚úì –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã. –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç: "${span.textContent}"`);
        } else {
            console.warn(`    ‚ö† –ù–µ –Ω–∞–π–¥–µ–Ω span –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —ç–ª–µ–º–µ–Ω—Ç–µ:`, item);
            console.warn(`    - HTML —ç–ª–µ–º–µ–Ω—Ç–∞:`, item.outerHTML.substring(0, 200));
        }
    });
    
    console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ –¥–ª—è ${itemType} –∏–≥—Ä–æ–∫–∞ ${playerId} –æ–±–Ω–æ–≤–ª–µ–Ω—ã`);
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
function setupRefreshButtons() {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    document.addEventListener('click', (e) => {
        const button = e.target.closest('.refresh-btn');
        if (!button) return;
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        
        const itemType = button.getAttribute('data-item');
        const playerId = button.getAttribute('data-player-id');
        
        if (!itemType || !playerId) {
            console.log('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç data-item –∏–ª–∏ data-player-id');
            return;
        }
        
        // –ü–æ–∫–∞ –∫–Ω–æ–ø–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
        console.log('üîÑ –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–∂–∞—Ç–∞:', itemType, '–¥–ª—è –∏–≥—Ä–æ–∫–∞:', playerId);
    }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function setupVotingButton() {
    const votingBtn = document.getElementById('currentPlayerBottomBtn');
    if (!votingBtn) {
        console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    votingBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        e.stopPropagation();
        await showVotingModal();
    });
}

// –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
async function showVotingModal() {
    try {
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        const { data: players, error: playersError } = await supabase
            .from('users')
            .select('id, name, email')
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (playersError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', playersError);
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤');
            return;
        }
        
        if (!players || players.length === 0) {
            alert('–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏');
            return;
        }
        
        // –ò—Å–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ (–Ω–µ–ª—å–∑—è –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ —Å–µ–±—è)
        const otherPlayers = players.filter(player => player.id !== currentUserId);
        
        if (otherPlayers.length === 0) {
            alert('–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –≥–æ–ª–æ—Å –∏–≥—Ä–æ–∫–∞
        const currentVoteStr = sessionStorage.getItem(`vote_${currentUserId}`);
        let currentVote = null;
        if (currentVoteStr) {
            try {
                currentVote = JSON.parse(currentVoteStr);
            } catch (e) {
                // –ï—Å–ª–∏ –Ω–µ JSON, –∑–Ω–∞—á–∏—Ç —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–ø—Ä–æ—Å—Ç–æ ID)
                currentVote = { targetId: currentVoteStr };
            }
        }
        
        // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏
        const playersHTML = otherPlayers.map(player => {
            const playerName = player.name || player.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            const isVoted = currentVote && currentVote.targetId === player.id;
            const playerColor = getPlayerColor(player.id);
            
            return `
                <div class="voting-modal-item">
                    <span class="voting-modal-player-name" style="color: ${playerColor};">${playerName}</span>
                    <div class="voting-modal-buttons">
                        <button class="vote-add-btn" data-player-id="${player.id}" ${isVoted ? 'disabled' : ''}>+ –≥–æ–ª–æ—Å</button>
                        <button class="vote-remove-btn" data-player-id="${player.id}" ${!isVoted ? 'disabled' : ''}>- –≥–æ–ª–æ—Å</button>
                    </div>
                </div>
            `;
        }).join('');
        
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = document.createElement('div');
        modal.className = 'voting-modal-overlay';
        modal.innerHTML = `
            <div class="voting-modal">
                <div class="voting-modal-header">
                    <h3>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h3>
                    <button class="voting-modal-close">&times;</button>
                </div>
                <div class="voting-modal-content">
                    ${playersHTML}
                </div>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        modal.querySelectorAll('.vote-add-btn').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                e.stopPropagation();
                const targetPlayerId = btn.getAttribute('data-player-id');
                await addVote(targetPlayerId);
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                modal.remove();
                await showVotingModal();
            });
        });
        
        modal.querySelectorAll('.vote-remove-btn').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                e.stopPropagation();
                const targetPlayerId = btn.getAttribute('data-player-id');
                await removeVote();
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                modal.remove();
                await showVotingModal();
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        modal.querySelector('.voting-modal-close').addEventListener('click', () => {
            modal.remove();
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        document.body.appendChild(modal);
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', err);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞
async function addVote(targetPlayerId) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    const confirmed = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ –≥–æ–ª–æ—Å—É–µ—Ç–µ –≤ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞?');
    if (!confirmed) {
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –∏–≥—Ä–æ–∫–µ
    let userStr = localStorage.getItem('currentUser');
    if (!userStr) {
        userStr = sessionStorage.getItem('currentUser');
    }
    const currentUser = JSON.parse(userStr);
    const currentUserName = currentUser.name || currentUser.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
    const firstLetter = currentUserName.charAt(0).toUpperCase();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≥–æ–ª–æ—Å–∞ –∏–∑ –ë–î
    const { data: lobbyData, error: fetchError } = await supabase
        .from('lobbies')
        .select('votes')
        .eq('lobby_id', parseInt(currentLobbyId))
        .maybeSingle();
    
    let allVotes = {};
    if (!fetchError && lobbyData && lobbyData.votes) {
        allVotes = lobbyData.votes;
    }
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ ID —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    const voterIdStr = String(currentUserId);
    const targetIdStr = String(targetPlayerId);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –≥–æ–ª–æ—Å
    allVotes[voterIdStr] = {
        targetId: targetIdStr,
        voterId: voterIdStr,
        voterName: currentUserName,
        firstLetter: firstLetter
    };
    
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ–ª–æ—Å:', allVotes);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    const { error: updateError } = await supabase
        .from('lobbies')
        .update({ votes: allVotes })
        .eq('lobby_id', parseInt(currentLobbyId));
    
    if (updateError) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞ –≤ –ë–î:', updateError);
        // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage
        if (updateError.code === '42703' || updateError.message?.includes('does not exist') || updateError.message?.includes('column')) {
            console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ votes –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
            const voteData = {
                targetId: targetPlayerId,
                voterId: currentUserId,
                voterName: currentUserName,
                firstLetter: firstLetter
            };
            sessionStorage.setItem(`vote_${currentUserId}`, JSON.stringify(voteData));
        }
    } else {
        console.log('‚úÖ –ì–æ–ª–æ—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î');
    }
    
    // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
    const voteData = {
        targetId: targetPlayerId,
        voterId: currentUserId,
        voterName: currentUserName,
        firstLetter: firstLetter
    };
    sessionStorage.setItem(`vote_${currentUserId}`, JSON.stringify(voteData));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
    await loadVoting();
    
    console.log('‚úÖ –ì–æ–ª–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω –∑–∞ –∏–≥—Ä–æ–∫–∞:', targetPlayerId);
}

// –£–¥–∞–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞
async function removeVote() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≥–æ–ª–æ—Å–∞ –∏–∑ –ë–î
    const { data: lobbyData, error: fetchError } = await supabase
        .from('lobbies')
        .select('votes')
        .eq('lobby_id', parseInt(currentLobbyId))
        .maybeSingle();
    
    let allVotes = {};
    if (!fetchError && lobbyData && lobbyData.votes) {
        allVotes = lobbyData.votes;
    }
    
    // –£–¥–∞–ª—è–µ–º –≥–æ–ª–æ—Å —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ (–ø—Ä–æ–±—É–µ–º –∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É, –∏ –∫–∞–∫ —á–∏—Å–ª–æ)
    const voterIdStr = String(currentUserId);
    delete allVotes[voterIdStr];
    delete allVotes[currentUserId];
    
    console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –≥–æ–ª–æ—Å, –æ—Å—Ç–∞–ª–æ—Å—å:', allVotes);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    const { error: updateError } = await supabase
        .from('lobbies')
        .update({ votes: allVotes })
        .eq('lobby_id', parseInt(currentLobbyId));
    
    if (updateError) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞ –∏–∑ –ë–î:', updateError);
        // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage
        if (updateError.code === '42703' || updateError.message?.includes('does not exist') || updateError.message?.includes('column')) {
            console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ votes –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
        }
    } else {
        console.log('‚úÖ –ì–æ–ª–æ—Å —É–¥–∞–ª–µ–Ω –∏–∑ –ë–î');
    }
    
    // –£–¥–∞–ª—è–µ–º –≥–æ–ª–æ—Å –∏–∑ sessionStorage
    sessionStorage.removeItem(`vote_${currentUserId}`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
    await loadVoting();
    
    console.log('‚úÖ –ì–æ–ª–æ—Å —É–¥–∞–ª–µ–Ω');
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è blur –≤ Supabase
async function saveBlurState(playerId, itemType, blurState) {
    try {
        if (!currentLobbyId) {
            console.log('–ù–µ—Ç currentLobbyId, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ sessionStorage');
            return;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage
        const blurKey = `blur_${playerId}_${itemType}`;
        sessionStorage.setItem(blurKey, blurState);
        console.log('üíæ –°–æ—Å—Ç–æ—è–Ω–∏–µ blur —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ sessionStorage:', blurKey, '=', blurState);
        
        // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
        try {
            console.log('üîÑ –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î...');
            console.log('   currentLobbyId:', currentLobbyId);
            console.log('   playerId:', playerId);
            console.log('   itemType:', itemType);
            console.log('   blurState:', blurState);
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –ª–æ–±–±–∏
            const { data: lobbyCheck, error: checkError } = await supabase
                .from('lobbies')
                .select('lobby_id')
                .eq('lobby_id', parseInt(currentLobbyId))
                .single();
            
            if (checkError) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–±–±–∏:', checkError);
                console.error('   –ö–æ–¥ –æ—à–∏–±–∫–∏:', checkError.code);
                console.error('   –°–æ–æ–±—â–µ–Ω–∏–µ:', checkError.message);
                return;
            }
            
            console.log('‚úÖ –î–æ—Å—Ç—É–ø –∫ –ª–æ–±–±–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, lobby_id:', lobbyCheck.lobby_id);
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur_states –∏–∑ –ª–æ–±–±–∏
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º SELECT * —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏
            let lobbyData = null;
            let fetchError = null;
            
            const result = await supabase
                .from('lobbies')
                .select('*')
                .eq('lobby_id', parseInt(currentLobbyId))
                .single();
            
            if (result.error) {
                fetchError = result.error;
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ª–æ–±–±–∏:', fetchError);
                console.error('   –ö–æ–¥ –æ—à–∏–±–∫–∏:', fetchError.code);
                console.error('   –°–æ–æ–±—â–µ–Ω–∏–µ:', fetchError.message);
                console.error('   –î–µ—Ç–∞–ª–∏:', fetchError.details);
                console.error('   –ü–æ–¥—Å–∫–∞–∑–∫–∞:', fetchError.hint);
                
                // –ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ 400 Bad Request, –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å RLS –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–æ–º
                if (fetchError.code === 'PGRST301' || fetchError.message?.includes('permission denied') || fetchError.message?.includes('RLS')) {
                    console.error('‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ (RLS). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Supabase.');
                }
                
                // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage
                if (fetchError.code === '42703' || 
                    fetchError.code === 'PGRST116' ||
                    fetchError.message?.includes('does not exist') || 
                    fetchError.message?.includes('column') ||
                    fetchError.message?.includes('lobbies.id') ||
                    fetchError.message?.includes('blur_states')) {
                    console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ blur_states –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
                    return;
                }
                return;
            } else {
                lobbyData = result.data;
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ª–æ–±–±–∏ –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ SELECT *');
                console.log('   –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏:', Object.keys(lobbyData));
                console.log('   –¢–µ–∫—É—â–∏–π blur_states:', lobbyData.blur_states);
                console.log('   –¢–∏–ø blur_states:', typeof lobbyData.blur_states);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏ –ø—É–Ω–∫—Ç–∞
            const blurStates = lobbyData.blur_states || {};
            if (!blurStates[playerId]) {
                blurStates[playerId] = {};
            }
            blurStates[playerId][itemType] = blurState;
            
            console.log('üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ blur_states:', JSON.stringify(blurStates, null, 2));
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ë–î
            const { data: updateData, error: updateError } = await supabase
                .from('lobbies')
                .update({ blur_states: blurStates })
                .eq('lobby_id', parseInt(currentLobbyId))
                .select();
            
            if (updateError) {
                // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage
                if (updateError.code === '42703' || 
                    updateError.code === 'PGRST116' ||
                    updateError.message?.includes('does not exist') || 
                    updateError.message?.includes('column')) {
                    console.log('‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ blur_states –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ sessionStorage');
                    console.log('   –ö–æ–¥ –æ—à–∏–±–∫–∏:', updateError.code);
                    console.log('   –°–æ–æ–±—â–µ–Ω–∏–µ:', updateError.message);
                    return;
                }
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è blur_states:', updateError);
                console.error('   –ö–æ–¥ –æ—à–∏–±–∫–∏:', updateError.code);
                console.error('   –°–æ–æ–±—â–µ–Ω–∏–µ:', updateError.message);
            } else {
                console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ blur —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Supabase!');
                console.log('   –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', updateData);
            }
        } catch (dbError) {
            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ë–î, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º sessionStorage
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î:', dbError);
            console.error('   –°–æ–æ–±—â–µ–Ω–∏–µ:', dbError.message);
            console.error('   –°—Ç–µ–∫:', dbError.stack);
        }
    } catch (err) {
        console.error('‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è blur:', err);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è blur –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
function updateBlurDisplay(playerId, itemType, blurState) {
    const isBlurred = blurState === '1' || blurState === 'true';
    
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    const currentPlayerCardEl = document.getElementById('currentPlayerCard');
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –¥–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    // playerId - —ç—Ç–æ ID —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞, —á—å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º
    // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¢–û–õ–¨–ö–û –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ (–ù–ï –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞)
    let allItems = document.querySelectorAll(`.player-info-item[data-item="${itemType}"][data-player-id="${playerId}"]`);
    
    console.log('üîç –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ blur –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', allItems.length);
    console.log('  - playerId (ID —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞):', playerId);
    console.log('  - itemType:', itemType);
    console.log('  - blurState:', blurState);
    console.log('  - isBlurred:', isBlurred);
    console.log('  - –∏—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-player-id="' + playerId + '"');
    
    // –ò–°–ö–õ–Æ–ß–ê–ï–ú —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    if (currentPlayerCardEl) {
        allItems = Array.from(allItems).filter(item => {
            const isInCurrentPlayerCard = currentPlayerCardEl.contains(item);
            if (isInCurrentPlayerCard) {
                console.log('  - –∏—Å–∫–ª—é—á–µ–Ω —ç–ª–µ–º–µ–Ω—Ç (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞):', item);
            }
            return !isInCurrentPlayerCard;
        });
        console.log('  - –ø–æ—Å–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞: –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', allItems.length);
    }
    
    // –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫ –Ω–µ –Ω–∞—à–µ–ª —ç–ª–µ–º–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π
    if (allItems.length === 0) {
        console.log('‚ö† –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ–∏—Å–∫–æ–º, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π...');
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫: –∏—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –Ω—É–∂–Ω—ã–º itemType –∏ playerId, –ò–°–ö–õ–Æ–ß–ê–Ø –∫–Ω–æ–ø–∫–∏
        let altItems = document.querySelectorAll(`.player-info-item[data-item="${itemType}"][data-player-id="${playerId}"]`);
        
        // –ò—Å–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        if (currentPlayerCardEl) {
            altItems = Array.from(altItems).filter(item => !currentPlayerCardEl.contains(item));
        }
        
        allItems = altItems;
        console.log('  - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ (—Ç–æ–ª—å–∫–æ .player-info-item): –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', allItems.length);
        
        // –ï—Å–ª–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –Ω–µ –Ω–∞—à–µ–ª, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–∏–ø—É –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å playerId –≤—Ä—É—á–Ω—É—é
        if (allItems.length === 0) {
            const allItemsByType = document.querySelectorAll(`.player-info-item[data-item="${itemType}"]`);
            console.log('  - –ø–æ–∏—Å–∫ –ø–æ —Ç–∏–ø—É (—Ç–æ–ª—å–∫–æ .player-info-item): –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', allItemsByType.length);
            
            // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            allItemsByType.forEach((item, idx) => {
                const itemPlayerId = item.getAttribute('data-player-id');
                const isInCurrentCard = currentPlayerCardEl && currentPlayerCardEl.contains(item);
                console.log(`  - —ç–ª–µ–º–µ–Ω—Ç ${idx + 1}: data-player-id="${itemPlayerId}", –∏—â–µ–º="${playerId}", –≤ —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ=${isInCurrentCard}`);
            });
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ playerId –≤—Ä—É—á–Ω—É—é –∏ –∏—Å–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∏ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            allItems = Array.from(allItemsByType).filter(item => {
                // –ò—Å–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏
                if (item.classList.contains('blur-toggle-btn') || item.tagName === 'BUTTON') {
                    return false;
                }
                
                // –ò—Å–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                if (currentPlayerCardEl && currentPlayerCardEl.contains(item)) {
                    return false;
                }
                
                const itemPlayerId = item.getAttribute('data-player-id');
                const matches = itemPlayerId === playerId;
                if (!matches) {
                    console.log(`  - —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç: playerId=${itemPlayerId}, –∏—â–µ–º=${playerId}`);
                }
                return matches;
            });
            console.log('  - –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', allItems.length);
        }
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –∏—Å–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    allItems = Array.from(allItems).filter(item => {
        const isButton = item.classList.contains('blur-toggle-btn') || 
                        item.tagName === 'BUTTON' || 
                        item.closest('.blur-toggle-btn');
        if (isButton) {
            console.log('  - –∏—Å–∫–ª—é—á–µ–Ω —ç–ª–µ–º–µ–Ω—Ç (—ç—Ç–æ –∫–Ω–æ–ø–∫–∞):', item);
        }
        return !isButton;
    });
    
    console.log('  - –ø–æ—Å–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫: –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', allItems.length);
    
    if (allItems.length === 0) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å blur.');
        return;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    console.log(`üìù –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ${allItems.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤...`);
    
    allItems.forEach((item, index) => {
        console.log(`  [${index + 1}/${allItems.length}] –û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞:`, item);
        
        // –ò—â–µ–º span —Å —Ç–µ–∫—Å—Ç–æ–º –≤–Ω—É—Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ (–Ω–µ –∫–Ω–æ–ø–∫—É)
        // –ò—â–µ–º span —Å data-seed –∞—Ç—Ä–∏–±—É—Ç–æ–º (–≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ)
        let textSpan = item.querySelector('span[data-seed]');
        
        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ span –±–µ–∑ –∫–ª–∞—Å—Å–∞ blur-toggle-btn
        if (!textSpan) {
            textSpan = item.querySelector('span:not(.blur-toggle-btn)');
        }
        
        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ª—é–±–æ–π span
        if (!textSpan) {
            const allSpans = item.querySelectorAll('span');
            console.log(`    - –Ω–∞–π–¥–µ–Ω–æ spans: ${allSpans.length}`);
            allSpans.forEach((span, spanIdx) => {
                if (!span.classList.contains('blur-toggle-btn') && 
                    !span.closest('.blur-toggle-btn')) {
                    if (!textSpan) {
                        textSpan = span;
                        console.log(`    - –≤—ã–±—Ä–∞–Ω span ${spanIdx + 1}`);
                    }
                }
            });
        }
        
        if (textSpan) {
            const beforeClasses = textSpan.className;
            const beforeFilter = window.getComputedStyle(textSpan).filter;
            console.log(`    - –Ω–∞–π–¥–µ–Ω textSpan`);
            console.log(`    - –¥–æ: –∫–ª–∞—Å—Å—ã="${beforeClasses}", filter="${beforeFilter}"`);
            
            if (isBlurred) {
                // –î–æ–±–∞–≤–ª—è–µ–º blur –∏ –∑–∞–º–µ–Ω—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ placeholder
                textSpan.classList.add('blurred-text');
                textSpan.textContent = '***'; // –ó–∞–º–µ–Ω—è–µ–º –Ω–∞ placeholder –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                // –£–±–∏—Ä–∞–µ–º inline —Å—Ç–∏–ª–∏, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è CSS –∫–ª–∞—Å—Å
                textSpan.style.removeProperty('filter');
                console.log(`    ‚úì Blur –¥–æ–±–∞–≤–ª–µ–Ω, –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ placeholder`);
            } else {
                // –£–±–∏—Ä–∞–µ–º blur (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ generateAndDisplayData)
                textSpan.classList.remove('blurred-text');
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º blur —á–µ—Ä–µ–∑ inline —Å—Ç–∏–ª—å
                textSpan.style.setProperty('filter', 'none', 'important');
                console.log(`    ‚úì Blur —É–±—Ä–∞–Ω`);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É
            requestAnimationFrame(() => {
                const afterClasses = textSpan.className;
                const afterFilter = window.getComputedStyle(textSpan).filter;
                console.log(`    - –ø–æ—Å–ª–µ: –∫–ª–∞—Å—Å—ã="${afterClasses}", filter="${afterFilter}"`);
                
                // –ï—Å–ª–∏ blur –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑
                if (isBlurred && afterFilter === 'none') {
                    console.log(`    ‚ö† Blur –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...`);
                    textSpan.classList.add('blurred-text');
                    textSpan.style.removeProperty('filter');
                } else if (!isBlurred && afterFilter !== 'none' && afterFilter.includes('blur')) {
                    console.log(`    ‚ö† Blur –Ω–µ —É–±—Ä–∞–Ω, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...`);
                    textSpan.classList.remove('blurred-text');
                    textSpan.style.setProperty('filter', 'none', 'important');
                }
            });
        } else {
            console.log(`    ‚ö† textSpan –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç–ª–µ–º–µ–Ω—Ç–µ ${index + 1}`);
            console.log(`    - HTML —ç–ª–µ–º–µ–Ω—Ç–∞:`, item.innerHTML.substring(0, 200));
        }
    });
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ requestAnimationFrame
    requestAnimationFrame(() => {
        console.log(`üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ requestAnimationFrame...`);
        allItems.forEach((item, index) => {
            const textSpan = item.querySelector('span:not(.blur-toggle-btn)');
            if (textSpan) {
                if (isBlurred) {
                    textSpan.classList.add('blurred-text');
                    textSpan.style.removeProperty('filter');
                } else {
                    textSpan.classList.remove('blurred-text');
                    textSpan.style.setProperty('filter', 'none', 'important');
                }
                console.log(`  ‚úì –≠–ª–µ–º–µ–Ω—Ç ${index + 1} –æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ`);
            }
        });
    });
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è blur
function subscribeToBlurUpdates() {
    if (!currentLobbyId) {
        console.log('–ù–µ—Ç currentLobbyId, realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã');
        return;
    }
    
    // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
    unsubscribeFromBlurUpdates();
    
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è blur_states –≤ –ª–æ–±–±–∏
    console.log('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º blur...');
    
    blurRealtimeChannel = supabase
        .channel(`blur-updates-${currentLobbyId}`)
        .on('postgres_changes', 
            { 
                event: 'UPDATE',
                schema: 'public',
                table: 'lobbies',
                filter: `lobby_id=eq.${currentLobbyId}`
            },
            (payload) => {
                console.log('üîÑ Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–±–±–∏:', payload);
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π player_colors
                if (payload.new && payload.new.player_colors) {
                    const newPlayerColors = payload.new.player_colors;
                    console.log('üì¶ –ü–æ–ª—É—á–µ–Ω—ã player_colors —á–µ—Ä–µ–∑ realtime:', newPlayerColors);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤
                    playerColorsMap = newPlayerColors;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage
                    const savedColorsKey = `playerColors_${currentLobbyId}`;
                    sessionStorage.setItem(savedColorsKey, JSON.stringify(playerColorsMap));
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∏–≥—Ä–æ–∫–∞—Ö –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
                    setTimeout(async () => {
                        await loadPlayersInfo();
                        await loadVoting();
                    }, 100);
                    
                    console.log('‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ realtime');
                }
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π votes (–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è)
                if (payload.new && payload.new.votes !== undefined) {
                    const newVotes = payload.new.votes || {};
                    console.log('üì¶ –ü–æ–ª—É—á–µ–Ω—ã votes —á–µ—Ä–µ–∑ realtime:', newVotes);
                    console.log('üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤:', Object.keys(newVotes).length);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
                    setTimeout(async () => {
                        await loadVoting();
                    }, 100);
                    
                    console.log('‚úÖ –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ realtime');
                }
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π cards_locked (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫)
                if (payload.new && payload.new.cards_locked !== undefined) {
                    const cardsLocked = payload.new.cards_locked;
                    const bunkerCardData = payload.new.bunker_card_data;
                    console.log('üì¶ –ü–æ–ª—É—á–µ–Ω–æ cards_locked —á–µ—Ä–µ–∑ realtime:', cardsLocked);
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º
                    applyCardsLockState(cardsLocked, bunkerCardData);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                    updateStartGameButtonText(cardsLocked);
                    
                    console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ realtime');
                }
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π bunker_card_data (–∫–∞—Ä—Ç–æ—á–∫–∞ –±—É–Ω–∫–µ—Ä–∞)
                if (payload.new && payload.new.bunker_card_data) {
                    const bunkerCardData = payload.new.bunker_card_data;
                    console.log('üì¶ –ü–æ–ª—É—á–µ–Ω—ã bunker_card_data —á–µ—Ä–µ–∑ realtime:', bunkerCardData);
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–Ω–∫–µ—Ä–∞
                    displayBunkerCard(bunkerCardData);
                    
                    console.log('‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –±—É–Ω–∫–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ realtime');
                }
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π blur_states
                if (!payload.new || !payload.new.blur_states) {
                    // –ï—Å–ª–∏ –Ω–µ—Ç blur_states, –Ω–æ –µ—Å—Ç—å player_colors –∏–ª–∏ votes, —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ –≤—ã—à–µ
                    if (!payload.new || (!payload.new.player_colors && !payload.new.blur_states && !payload.new.votes)) {
                        console.log('‚ÑπÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å–≤—è–∑–∞–Ω–æ —Å blur_states, player_colors –∏–ª–∏ votes, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
                    }
                    return;
                }
                
                const blurStates = payload.new.blur_states || {};
                console.log('üì¶ –ü–æ–ª—É—á–µ–Ω—ã blur_states —á–µ—Ä–µ–∑ realtime:', blurStates);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
                Object.keys(blurStates).forEach(playerId => {
                    const playerBlurStates = blurStates[playerId] || {};
                    Object.keys(playerBlurStates).forEach(itemType => {
                        const blurState = playerBlurStates[itemType];
                        // –û–±–Ω–æ–≤–ª—è–µ–º sessionStorage
                        const blurKey = `blur_${playerId}_${itemType}`;
                        sessionStorage.setItem(blurKey, blurState);
                        
                        console.log(`üîÑ Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ blur: playerId=${playerId}, itemType=${itemType}, blurState=${blurState}`);
                        
                        // –ï—Å–ª–∏ blur —Å–Ω—è—Ç (blurState === '0'), –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                        if (blurState === '0' || blurState === 0) {
                            console.log(`  ‚úì Blur —Å–Ω—è—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${itemType} –∏–≥—Ä–æ–∫–∞ ${playerId}`);
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
                            setTimeout(() => {
                                generateAndDisplayData(playerId, itemType);
                            }, 100);
                        } else {
                            // –ï—Å–ª–∏ blur —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            updateBlurDisplay(playerId, itemType, blurState);
                        }
                        
                        console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω blur –¥–ª—è playerId=${playerId}, itemType=${itemType}, blurState=${blurState}`);
                    });
                });
            }
        )
        .subscribe((status) => {
            if (status === 'SUBSCRIBED') {
                console.log('‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è blur –∞–∫—Ç–∏–≤–Ω–∞');
            } else if (status === 'CHANNEL_ERROR') {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è blur');
            } else {
                console.log('‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:', status);
            }
        });
}

// –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π blur
function unsubscribeFromBlurUpdates() {
    if (blurRealtimeChannel) {
        supabase.removeChannel(blurRealtimeChannel);
        blurRealtimeChannel = null;
    }
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
function subscribeToPlayersUpdates() {
    if (!currentLobbyId) {
        console.log('–ù–µ—Ç currentLobbyId, realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω—ã');
        return;
    }
    
    // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
    unsubscribeFromPlayersUpdates();
    
    console.log('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º –∏–≥—Ä–æ–∫–æ–≤...');
    
    const lobbyIdNum = parseInt(currentLobbyId);
    
    playersRealtimeChannel = supabase
        .channel(`players-updates-${currentLobbyId}`)
        .on('postgres_changes', 
            { 
                event: 'INSERT',
                schema: 'public',
                table: 'users',
                filter: `lobby_id=eq.${lobbyIdNum}`
            },
            async (payload) => {
                const playerName = payload.new?.name || payload.new?.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                const newPlayerId = payload.new?.id;
                console.log('‚úÖ –ò–≥—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ª–æ–±–±–∏:', playerName);
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                if (newPlayerId) {
                    await updatePlayerColorsForNewPlayer(newPlayerId);
                }
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–±–ª–æ–∫ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                await loadVoting();
            }
        )
        .on('postgres_changes', 
            { 
                event: 'UPDATE',
                schema: 'public',
                table: 'users'
            },
            async (payload) => {
                console.log('üîÑ Realtime UPDATE users - –ø–æ–ª–Ω—ã–π payload:', payload);
                
                const oldLobbyId = payload.old?.lobby_id;
                const newLobbyId = payload.new?.lobby_id;
                const updatedUserId = payload.new?.id;
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è lobby_id (—É—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞, null, 0)
                const compareLobbyId = (val1, val2) => {
                    if (val1 === val2) return true;
                    if (val1 == null || val2 == null) return false;
                    return parseInt(val1) === parseInt(val2);
                };
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                const oldLobbyIdNum = oldLobbyId != null && oldLobbyId !== 0 ? parseInt(oldLobbyId) : (oldLobbyId === 0 ? 0 : null);
                const newLobbyIdNum = newLobbyId != null && newLobbyId !== 0 ? parseInt(newLobbyId) : (newLobbyId === 0 ? 0 : null);
                
                console.log('üîÑ Realtime UPDATE users:', {
                    oldLobbyId,
                    newLobbyId,
                    oldLobbyIdNum,
                    newLobbyIdNum,
                    currentLobbyId: lobbyIdNum,
                    updatedUserId
                });
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –Ω–∞—à–µ–º—É –ª–æ–±–±–∏
                if (!compareLobbyId(oldLobbyId, lobbyIdNum) && compareLobbyId(newLobbyId, lobbyIdNum)) {
                    const playerName = payload.new?.name || payload.new?.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                    const newPlayerId = payload.new?.id;
                    console.log('‚úÖ –ò–≥—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –ª–æ–±–±–∏:', playerName);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                    if (newPlayerId) {
                        await updatePlayerColorsForNewPlayer(newPlayerId);
                    }
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–±–ª–æ–∫ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º)
                    await loadVoting();
                    return;
                }
                
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ updated_at (heartbeat)
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Ç–æ–ª—å–∫–æ updated_at, –∞ –Ω–µ lobby_id
                if (compareLobbyId(oldLobbyId, newLobbyId) && compareLobbyId(newLobbyId, lobbyIdNum)) {
                    // –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (heartbeat), –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
                    return;
                }
                
                // –ï—Å–ª–∏ –Ω–æ–≤—ã–π lobby_id –Ω–µ —Ä–∞–≤–µ–Ω —Ç–µ–∫—É—â–µ–º—É (0, null, undefined –∏–ª–∏ –¥—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä)
                // –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–∏–±–æ –≤—ã—à–µ–ª –∏–∑ –ª–æ–±–±–∏, –ª–∏–±–æ –ø–µ—Ä–µ—à–µ–ª –≤ –¥—Ä—É–≥–æ–µ
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –Ω–∞—à–µ–º –ª–æ–±–±–∏
                const isNotInOurLobby = !compareLobbyId(newLobbyId, lobbyIdNum) || 
                                        newLobbyId === 0 || 
                                        newLobbyId === null || 
                                        newLobbyId === undefined;
                
                // –ï—Å–ª–∏ –Ω–æ–≤—ã–π lobby_id –Ω–µ —Ä–∞–≤–µ–Ω —Ç–µ–∫—É—â–µ–º—É - –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                // loadPlayersInfo() –∏ loadVoting() –∑–∞–≥—Ä—É–∂–∞—é—Ç —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ —Å —Ç–µ–∫—É—â–∏–º lobby_id,
                // –ø–æ—ç—Ç–æ–º—É –∏–≥—Ä–æ–∫ —Å newLobbyId !== lobbyIdNum –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
                // –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ–º oldLobbyId, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å undefined
                if (isNotInOurLobby) {
                    const playerName = payload.old?.name || payload.new?.name || payload.old?.email || payload.new?.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                    console.log('üëã –ò–≥—Ä–æ–∫ –ø–æ–∫–∏–Ω—É–ª/–ø–æ–∫–∏–¥–∞–µ—Ç –ª–æ–±–±–∏ - –û–ë–ù–û–í–õ–Ø–ï–ú!', playerName, {
                        oldLobbyId,
                        newLobbyId,
                        lobbyIdNum,
                        updatedUserId
                    });
                    
                    try {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–±–ª–æ–∫ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                        await loadVoting();
                        console.log('‚úÖ –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', error);
                    }
                }
            }
        )
        .on('postgres_changes', 
            { 
                event: 'DELETE',
                schema: 'public',
                table: 'users'
            },
            async (payload) => {
                const deletedLobbyId = payload.old?.lobby_id;
                
                // –ï—Å–ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –Ω–∞—à–µ–º –ª–æ–±–±–∏
                if (deletedLobbyId === lobbyIdNum) {
                    const playerName = payload.old?.name || payload.old?.email || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                    console.log('üëã –ò–≥—Ä–æ–∫ —É–¥–∞–ª–µ–Ω –∏–∑ –ª–æ–±–±–∏:', playerName);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–±–ª–æ–∫ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                    await loadVoting();
                }
            }
        )
        .subscribe((status) => {
            if (status === 'SUBSCRIBED') {
                console.log('‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤ –∞–∫—Ç–∏–≤–Ω–∞ –¥–ª—è –ª–æ–±–±–∏:', lobbyIdNum);
            } else if (status === 'CHANNEL_ERROR') {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤');
            } else {
                console.log('‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∏–≥—Ä–æ–∫–æ–≤:', status);
            }
        });
}

// –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤
function unsubscribeFromPlayersUpdates() {
    if (playersRealtimeChannel) {
        supabase.removeChannel(playersRealtimeChannel);
        playersRealtimeChannel = null;
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
function setupFlipCards() {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase = false, —á—Ç–æ–±—ã blur –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–º
    document.addEventListener('click', (e) => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è blur (–ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ target, –∏ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ —Ü–µ–ø–æ—á–∫–µ)
        const blurButton = e.target.closest('.blur-toggle-btn');
        if (blurButton || e.target.classList.contains('blur-toggle-btn')) {
            return;
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const refreshButton = e.target.closest('.refresh-btn');
        if (refreshButton || e.target.classList.contains('refresh-btn')) {
            return;
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –ª—é–±—ã–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
        if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
            return;
        }
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –∫–ª–∏–∫ –ø—Ä–æ–∏–∑–æ—à–µ–ª –≤–Ω—É—Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –∫–ª–∞—Å—Å–æ–º blur-toggle-btn
        let currentElement = e.target;
        while (currentElement && currentElement !== document.body) {
            if (currentElement.classList && currentElement.classList.contains('blur-toggle-btn')) {
                return;
            }
            currentElement = currentElement.parentElement;
        }
        
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ (–æ–Ω–∏ –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ)
        if (e.target.closest('.player-card-flip')) {
            return;
        }
        
        const flipCard = e.target.closest('.flip-card');
        if (flipCard) {
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –ì–û–õ–û–°–û–í–ê–ù–ò–Ø - –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
            const votingBlock = flipCard.querySelector('.voting-block');
            if (votingBlock) {
                const flipCardInner = flipCard.querySelector('.flip-card-inner');
                if (flipCardInner) {
                    flipCardInner.classList.toggle('flipped');
                }
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞
            if (flipCard.classList.contains('cards-locked')) {
                console.log('‚ÑπÔ∏è –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–∞–∂–º–∏—Ç–µ "Start Game" –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
                return;
            }
            
            const flipCardInner = flipCard.querySelector('.flip-card-inner');
            if (flipCardInner) {
                flipCardInner.classList.toggle('flipped');
            }
        }
    }, false); // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º bubble phase, —á—Ç–æ–±—ã blur –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (capture) —Å—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–º
}

// –í—ã—Ö–æ–¥ –∏–∑ –ª–æ–±–±–∏
async function exitFromLobby() {
    try {
        if (!currentUserId) {
            window.location.href = 'index.html';
            return;
        }
        
        // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
        const exitBtn = document.getElementById('exitLobbyBtn');
        if (exitBtn) {
            exitBtn.disabled = true;
            exitBtn.textContent = '–í—ã—Ö–æ–¥...';
        }
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º lobby_id –≤ –ë–î (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ 0)
        const { error: updateError } = await supabase
            .from('users')
            .update({ 
                lobby_id: 0,
                updated_at: new Date().toISOString()
            })
            .eq('id', currentUserId);
        
        if (updateError) {
            console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ª–æ–±–±–∏:', updateError);
        } else {
            console.log('‚úÖ lobby_id —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ 0 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUserId);
        }
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º heartbeat –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ü–ï–†–ï–î –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ë–î
        stopHeartbeat();
        stopActivityCheck();
        
        // –û—Ç–º–µ–Ω—è–µ–º —Ç–∞–π–º–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
        if (inactivityTimer) {
            clearTimeout(inactivityTimer);
            inactivityTimer = null;
        }
        
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã —Å–æ–±—ã—Ç–∏–µ —É—Å–ø–µ–ª–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ realtime
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–æ–≤ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ "–ü–æ–ª –∏ –≤–æ–∑—Ä–∞—Å—Ç"
        const currentExitCount = parseInt(sessionStorage.getItem(`exitCount_${currentUserId}`) || '0');
        sessionStorage.setItem(`exitCount_${currentUserId}`, (currentExitCount + 1).toString());
        console.log('üîÑ –°—á–µ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–æ–≤ —É–≤–µ–ª–∏—á–µ–Ω, –ø–∞—Ä–∞–º–µ—Ç—Ä "–ü–æ–ª –∏ –≤–æ–∑—Ä–∞—Å—Ç" –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ');
        
        // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        unsubscribeFromBlurUpdates();
        unsubscribeFromPlayersUpdates();
        
        // –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–æ–±–±–∏ –∏–∑ sessionStorage
        sessionStorage.removeItem('currentLobbyId');
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        window.location.href = 'index.html';
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ª–æ–±–±–∏:', err);
        // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        window.location.href = 'index.html';
    }
}

// Heartbeat - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
async function sendHeartbeat() {
    if (!currentUserId) {
        console.log('‚ö†Ô∏è Heartbeat: –Ω–µ—Ç currentUserId');
        return;
    }
    
    try {
        const timestamp = new Date().toISOString();
        console.log(`üíì Heartbeat –æ—Ç–ø—Ä–∞–≤–∫–∞: userId=${currentUserId}, timestamp=${timestamp}`);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º updated_at –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        const { data, error } = await supabase
            .from('users')
            .update({ updated_at: timestamp })
            .eq('id', currentUserId)
            .select();
        
        if (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ heartbeat:', error);
        } else {
            console.log('‚úÖ Heartbeat —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:', data);
        }
    } catch (err) {
        console.error('‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ heartbeat:', err);
    }
}

// –ó–∞–ø—É—Å–∫ heartbeat (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
function startHeartbeat() {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É
    sendHeartbeat();
    
    // –ó–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    heartbeatInterval = setInterval(() => {
        sendHeartbeat();
    }, 5000);
    
    console.log('‚úÖ Heartbeat –∑–∞–ø—É—â–µ–Ω');
}

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ heartbeat
function stopHeartbeat() {
    if (heartbeatInterval) {
        clearInterval(heartbeatInterval);
        heartbeatInterval = null;
        console.log('üõë Heartbeat –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥
async function checkInactivePlayers() {
    if (!currentLobbyId) {
        console.log('‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö: –Ω–µ—Ç currentLobbyId');
        return;
    }
    
    try {
        console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –ª–æ–±–±–∏: ${currentLobbyId}`);
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        const { data: players, error: playersError } = await supabase
            .from('users')
            .select('id, name, email, updated_at')
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (playersError) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤:', playersError);
            return;
        }
        
        if (!players || players.length === 0) {
            console.log('‚ÑπÔ∏è –ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
            return;
        }
        
        console.log(`üìä –ù–∞–π–¥–µ–Ω–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏: ${players.length}`);
        
        const now = new Date();
        const inactiveThreshold = 30000; // 30 —Å–µ–∫—É–Ω–¥ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        for (const player of players) {
            if (player.id === currentUserId) {
                console.log(`‚úì –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞: ${player.name || player.email}`);
                continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            }
            
            if (!player.updated_at) {
                console.log(`‚ö†Ô∏è –ò–≥—Ä–æ–∫ ${player.name || player.email} –Ω–µ –∏–º–µ–µ—Ç updated_at`);
                continue;
            }
            
            const lastActivity = new Date(player.updated_at);
            const timeSinceActivity = now - lastActivity;
            const secondsInactive = Math.floor(timeSinceActivity / 1000);
            
            console.log(`‚è±Ô∏è –ò–≥—Ä–æ–∫ ${player.name || player.email}: –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω ${secondsInactive} —Å–µ–∫—É–Ω–¥ (–ø–æ—Ä–æ–≥: 30 —Å–µ–∫)`);
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω –±–æ–ª–µ–µ 30 —Å–µ–∫—É–Ω–¥
            if (timeSinceActivity > inactiveThreshold) {
                console.log(`‚è∞ –ò–≥—Ä–æ–∫ ${player.name || player.email} –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω ${secondsInactive} —Å–µ–∫—É–Ω–¥, –≤—ã–≤–æ–¥–∏–º –∏–∑ –ª–æ–±–±–∏`);
                
                // –£–¥–∞–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –∏–∑ –ª–æ–±–±–∏
                await removeInactivePlayer(player.id);
            }
        }
    } catch (err) {
        console.error('‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤:', err);
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏–∑ –ª–æ–±–±–∏
async function removeInactivePlayer(playerId) {
    if (!currentLobbyId) return;
    
    try {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º lobby_id = 0
        const { error: updateError } = await supabase
            .from('users')
            .update({ 
                lobby_id: 0,
                updated_at: new Date().toISOString()
            })
            .eq('id', playerId);
        
        if (updateError) {
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞:', updateError);
            return;
        }
        
        console.log(`‚úÖ –ò–≥—Ä–æ–∫ ${playerId} —É–¥–∞–ª–µ–Ω –∏–∑ –ª–æ–±–±–∏ –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏`);
        
        // –£–¥–∞–ª—è–µ–º –≥–æ–ª–æ—Å–∞ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏–∑ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        await removePlayerVotes(playerId);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–±–ª–æ–∫ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ realtime)
        await loadVoting();
        
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞:', err);
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤ –∏–≥—Ä–æ–∫–∞ –∏–∑ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
async function removePlayerVotes(playerId) {
    if (!currentLobbyId) return;
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≥–æ–ª–æ—Å–∞
        const { data: lobbyData, error: fetchError } = await supabase
            .from('lobbies')
            .select('votes')
            .eq('lobby_id', parseInt(currentLobbyId))
            .maybeSingle();
        
        if (fetchError) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤:', fetchError);
            return;
        }
        
        let allVotes = {};
        if (lobbyData && lobbyData.votes) {
            allVotes = lobbyData.votes;
        }
        
        // –£–¥–∞–ª—è–µ–º –≥–æ–ª–æ—Å–∞ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∫–∞–∫ –≥–æ–ª–æ—Å—É—é—â–µ–≥–æ)
        const playerIdStr = String(playerId);
        delete allVotes[playerIdStr];
        delete allVotes[playerId];
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–∞
        const { error: updateError } = await supabase
            .from('lobbies')
            .update({ votes: allVotes })
            .eq('lobby_id', parseInt(currentLobbyId));
        
        if (updateError) {
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤ –∏–≥—Ä–æ–∫–∞:', updateError);
        } else {
            console.log(`üóëÔ∏è –ì–æ–ª–æ—Å–∞ –∏–≥—Ä–æ–∫–∞ ${playerId} —É–¥–∞–ª–µ–Ω—ã –∏–∑ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è`);
        }
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤ –∏–≥—Ä–æ–∫–∞:', err);
    }
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
function startActivityCheck() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
    checkInactivePlayers();
    
    // –ó–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    activityCheckInterval = setInterval(() => {
        checkInactivePlayers();
    }, 10000);
    
    console.log('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –∑–∞–ø—É—â–µ–Ω–∞');
}

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
function stopActivityCheck() {
    if (activityCheckInterval) {
        clearInterval(activityCheckInterval);
        activityCheckInterval = null;
        console.log('üõë –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function setupInactivityHandlers() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ beforeunload - –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
    window.addEventListener('beforeunload', async () => {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        await sendHeartbeat();
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
        stopHeartbeat();
        stopActivityCheck();
        
        // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        unsubscribeFromBlurUpdates();
        unsubscribeFromPlayersUpdates();
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ visibilitychange - –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º–æ–π/–Ω–µ–≤–∏–¥–∏–º–æ–π
    document.addEventListener('visibilitychange', async () => {
        if (document.hidden) {
            // –í–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞ - –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
            inactivityTimer = setTimeout(async () => {
                console.log('‚è∞ –í–∫–ª–∞–¥–∫–∞ –±—ã–ª–∞ —Å–∫—Ä—ã—Ç–∞ –±–æ–ª–µ–µ 30 —Å–µ–∫—É–Ω–¥, –≤—ã—Ö–æ–¥–∏–º –∏–∑ –ª–æ–±–±–∏');
                await exitFromLobby();
            }, 30000);
        } else {
            // –í–∫–ª–∞–¥–∫–∞ –≤–∏–¥–∏–º–∞ - –æ—Ç–º–µ–Ω—è–µ–º —Ç–∞–π–º–µ—Ä –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            if (inactivityTimer) {
                clearTimeout(inactivityTimer);
                inactivityTimer = null;
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            await sendHeartbeat();
        }
    });
    
    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
}

// –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –≤—Å–µ—Ö realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', () => {
    stopHeartbeat();
    stopActivityCheck();
    unsubscribeFromBlurUpdates();
    unsubscribeFromPlayersUpdates();
});

